
\documentclass[11pt]{amsart}
\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
%\usepackage{showlabels}
\usepackage{amsthm}

\usepackage[english]{babel}
\usepackage{yfonts}
\usepackage[T1]{fontenc}
\usepackage[utf8x]{inputenc}
\usepackage{enumerate}
\usepackage{enumitem}
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage{verbatim}
\usepackage{faktor}
\usepackage{xcolor}
\usepackage{xfrac}
\usepackage{tikz,tikz-cd}
\usepackage[all]{xy}
\usepackage{hyperref}

\usepackage{calrsfs}
\DeclareMathAlphabet{\pazocal}{OMS}{zplm}{m}{n}

\newcommand{\M}[4]{\overline{\mathcal M}_{#1,#2}(#3,#4)}
\newcommand{\Mone}[3]{\overline{\mathcal M}^{(1)}_{#1}(#2,#3)}
\newcommand{\PP}{\mathbb P}
\newcommand{\OO}{\mathcal O}
\renewcommand{\to}{\rightarrow}
\newcommand{\pr}{\rm{pr}}
\newcommand{\Aaff}{\mathbb A}
\newcommand{\A}{\mathcal A}
\newcommand{\B}{\mathcal B}
\newcommand{\X}{\pazocal X}
\newcommand{\XP}{\pazocal{X\!P}}
\newcommand{\tXP}{\widetilde{\pazocal{X\!P}}}
\renewcommand{\L}{\mathcal L}
\newcommand{\hL}{\hat{\mathcal L}}
\newcommand{\C}{\mathfrak C}
\newcommand{\cC}{\mathcal C}
\newcommand{\Z}{\pazocal Z}
\newcommand{\Zp}{\pazocal Z^p}
\newcommand{\tZ}{\widetilde{\pazocal Z}}
\newcommand{\tZp}{\widetilde{\pazocal Z}^p}
\newcommand{\MM}{\mathfrak M}
\newcommand{\pP}{\mathfrak P}
\newcommand{\hP}{\hat{\mathfrak P}}
\newcommand{\hM}{\hat{\mathfrak M}}
\newcommand{\oM}{\overline{\pazocal M}}
\newcommand{\tM}{\widetilde{\pazocal M}}
\newcommand{\R}{\operatorname{R}}
\newcommand{\Gm}{\mathbb{G}_{\rm{m}}}
\newcommand{\w}{\mathbf{w}}
\newcommand{\PtoM}{\rho}
\newcommand{\vir}[1]{[#1]^{\rm{vir}}}
\newcommand{\virloc}[1]{[#1]^{\rm{vir}}_{\rm{loc}}}

\newcommand{\bq}{\begin{equation}}
\newcommand{\eq}{\end{equation}}
\newcommand{\ba}{\begin{aligned}}
\newcommand{\ea}{\end{aligned}}
\newcommand{\be}{\begin{enumerate}}
\newcommand{\ee}{\end{enumerate}}
\newcommand{\bsm}{\left(\begin{smallmatrix}}
\newcommand{\esm}{\end{smallmatrix}\right)}                   
\newcommand{\bpm}{\begin{pmatrix}}
\newcommand{\epm}{\end{pmatrix}}
\newcommand{\barr}{\begin{displaymath}\begin{array}{cccc}}
\newcommand{\earr}{\end{array}\end{displaymath}}
\newcommand{\barrl}{\begin{displaymath}\begin{array}{lcl}}
\newcommand{\earrl}{\end{array}\end{displaymath}}
\newcommand{\barl}{\begin{displaymath}\begin{array}{l}}
\newcommand{\earl}{\end{array}\end{displaymath}}
\newcommand{\bxym}{ \begin{displaymath}\xymatrix }
\newcommand{\exym}{\end{displaymath}}
\newcommand{\bcd}{\begin{center}\begin{tikzcd}}
\newcommand{\ecd}{\end{tikzcd}\end{center}}

\newcommand{\tr}{{\rm tr}}
\newcommand{\Isom}{\text{Isom}}
\newcommand{\Spec}{\operatorname{Spec}}
\newcommand{\Proj}{\operatorname{Proj}}
\newcommand{\Pic}{\operatorname{Pic}}
\newcommand{\Hom}{\operatorname{Hom}}
\newcommand{\id}{{\rm id}}

\theoremstyle{plain}
\newtheorem{thm}{Theorem}[section]
\newtheorem{lem}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{cor}[thm]{Corollary}
\newtheorem*{teo*}{Theorem}
\newtheorem{ipotesi}{ipotesi}
\newtheorem*{nota}{Nota}
\newtheorem{claim}{Claim}
\newtheorem{question}[thm]{Question}

\theoremstyle{definition}
\newtheorem{example}[thm]{Example}
\newtheorem{ex}[thm]{Example}
\newtheorem{dfn}[thm]{Definition}
\newtheorem{remark}[thm]{Remark}
\newtheorem{com}[thm]{Comment}
\newtheorem{num}{Number}
\newtheorem*{sketch}{Sketch}
\newtheorem*{rem}{Remark}


\newcommand{\todo}[1]{\vspace{5mm}\par \noindent
\framebox{\begin{minipage}[c]{0.95 \textwidth} \tt #1\end{minipage}} \vspace{5mm} \par}

\def\ti{-\allowhyphens}
\newcommand{\thismonth}{\ifcase\month % case 0 --- impossible!
  \or January\or February\or March\or April\or May\or June%
  \or July\or August\or September\or October\or November%
  \or December\fi}
\newcommand{\thismonthyear}{{\thismonth} {\number\year}}
\newcommand{\thisdaymonthyear}{{\number\day} {\thismonth} {\number\year}}

\title{Reduced GW invariants from cuspidal curves}
\author{L.Battistella, F.Carocci, C.Manolache}
\date{\today}
\begin{document}

\begin{abstract}
abstract
\end{abstract}

\maketitle


The moduli stack of stable maps to projective space is a fundamental object in Gromov-Witten theory, since any moduli space of maps to a (smooth) projective variety is cut inside that of the ambient projective space by a set of induced equations. Yet its structure in higher genus is still largely mysterious.

Recall that, in genus zero, $\M{0}{n}{\PP^r}{d}$ is a smooth stack of the expected dimension $\operatorname{vdim}=r-3+d(r+1)+n$ (we see that it is unobstructed from the fact that $H^1(\PP^1,f^*T_{\PP^r})=0$ for any map $f\colon\PP^1\to\PP^r$). Furthermore, for any split vector bundle $E=\oplus_{i} \mathcal O_{\PP^r}(l_i)$, the sheaf $\pi_*f^*E$ (where $\pi$ is the structure map of the universal curve and $f$ the universal stable map) is actually a vector bundle on $\M{0}{n}{\PP^r}{d}$.
\bcd
\mathcal C_{0,n}(\PP^r,d)\ar[r,"f"]\ar[d,"\pi"] & \PP^r\times \M{0}{n}{\PP^r}{d} \\
\M{0}{n}{\PP^r}{d} &
\ecd

It is a matter of functoriality of virtual fundamental classes \cite{KON} \cite{CKL} \cite{KKP} that, if $i\colon X\to \PP^r$ is a complete intersection of degree $(l_1,\ldots,l_k)$ (if $X$ is cut by a generic section $s\in H^0(\PP^r,E)$, then the induced section $\tilde s=\pi_*f^*(s)$ is also generic) and we denote by $j$ the corresponding inclusion
$$\bigsqcup_{\beta\in A_1(X)\colon i_*(\beta)=d}\M{0}{n}{X}{\beta}\hookrightarrow\M{0}{n}{\PP^r}{d}$$
then the following equality, expected by the interpretation of Chern classes as zero loci, holds:
$$j_*[\bigsqcup_{\beta\in A_1(X)\colon i_*(\beta)=d}\M{0}{n}{X}{\beta}]^{\operatorname{vir}}=c_{\operatorname{top}}(E)\cap[\M{0}{n}{\PP^r}{d}].$$
This so-called ``hyperplane property'' allows us to compute GW invariants of complete intersections as twisted invariants on projective space.
The situation in higher genera is much more intricated: the moduli space $\M{g}{n}{\PP^r}{d}$ is neither irreducible, nor pure dimensional; the sheaf $\pi_*f^*\mathcal O_{\PP^r}(l)$ is not a vector bundle. One of the reason for this (in fact the only reason in genus one) is that there are maps from reducible curves with a genus $g$ core that is contracted and some rational tails that carry all the degree; if $f\colon C\to \PP^r$ is such a map, then $H^1(C,f^*\mathcal O_{\PP^r}(1))\neq 0$, as can be easily deduced from the normalisation sequence.
\section{Genus one stable maps to $\PP^r$ - Equations, components and alternate compactifications}

\subsection{Local equations and components}

The geometry of the genus one moduli space of Kontsevich' stable maps to projective space $\M{1}{n}{\PP^r}{d}$ has been widely studied since \cite{Vre} and is by now well understood. Assume $d>0$. Let $E$ be a smooth genus one curve with a non-constant morphism $f\colon E\to \PP^r$; then $H^1(E,f^*T_{\PP^r})=0$ by Riemann-Roch, hence we may define the \emph{main component} of $\M{1}{n}{\PP^r}{d}$ as the closure of the locus of maps the source of which is a smooth genus one curve. It is irreducible of the expected dimension $\operatorname{vdim}=d(r+1)+n$. On the other hand, for every positive integer $k$ and partitions $\lambda$ of $d$ into $k$ (positive) parts and $\mu$ of $n$ into $k$ (positive) parts, consider the boundary component $D_{\lambda,\mu}(\PP^r,d)$ that is the closure of the locus where (i) the source curve is obtained by gluing a smooth elliptic curve with $k$ many $\PP^1$'s (as rational tails), (ii) the map contracts the core elliptic curve to a point, and (iii) the rational tail $R_i$ has degree $\lambda_i$ and $\mu_i$ many marked points. In fact $D_{\lambda,\mu}(\PP^r,d)$ is the image of the gluing morphism from the fiber product
$$\M{1}{k}{\PP^r}{0}\times_{\PP^r}\prod_{i=1}^k\M{0}{\mu_i+1}{\PP^r}{\lambda_i}.$$

\begin{prop}\label{prop:components}
\emph{(1)} The set of irreducible components of $\M{1}{n}{\PP^r}{d}$ is in bijection with $\{(\lambda\vdash d,\mu\vdash n)|\ \#(\text{parts})(\lambda)=\#(\text{parts})(\mu)\}\cup\{\circ=\operatorname{main}\}$, i.e.
$$\M{1}{n}{\PP^r}{d}=\M{1}{n}{\PP^r}{d}^\circ\cup\bigcup_{\lambda,\mu}D_{\lambda,\mu}(\PP^r,d).$$

\emph{(2)} Let $(E {}_{p_1,\ldots,p_k}\sqcup_{q_1,\ldots,q_k}\bigsqcup_{i=1}^k R_i,f)$ be a degenerate stable map with $k$ rational tails; then it lies in the boundary of the main component if and only if $\operatorname{d}\!f(T_{q_i}R_i)$ are \emph{linearly dependent} in $T_{f(E)}\PP^r$.
\end{prop}
 
In order to understand how the Gromov-Witten invariants differ from the naive expectation of counting smooth embedded genus $g$ curves in the given homology class, one needs to have a good understanding of the virtual fundamental class and of its splitting on the various components. 
This has led to the study of explicit local equation for the moduli space of stable maps in a smooth (over $\mathfrak M_{1,n}$) ambient space \cite{HL}, which we shall now briefly explain. Recall that a map from a scheme $C$ to projective $r$-space is the same as the datum of a line bundle $L$ on $C$ together with $r+1$ global sections in $H^0(C,L)$ that generate the line bundle at every point of $C$. Then it seems natural to embed the space of stable maps as an open inside $\pi_*\mathcal L^{\oplus r+1}$ on the universal Picard stack $\mathfrak{P}_{1,n}$. The problem is that this cone is not smooth, due to the jumps in fiber dimension at the boundary.
%(besides there is a small issue due to the $\mathbb G_m$ automorphism group of objects of $\mathfrak{P}_{1,n}$, which can be avoided by dishomogenising).

Let $[f\colon C\to \PP^r]$ be a point of $\M{1}{n}{\PP^r}{d}$; we may fix homogeneous coordinates on $\PP^r$ in a way that $D_0:=f^*\{X_0=0\}$ is a $d$-uple of smooth points on $C$ (i.e. \'{e}tale on the base) (this property will hold in a neighbourhood of $[f]$). This gives a map from (an \'{e}tale chart of) $\M{1}{n}{\PP^r}{d}$ to (an \'{e}tale chart of) the moduli space of pre-stable curves with a degree $d$ divisor $\mathfrak M_{1,n}^{\operatorname{div}=d}$, that we may assume to be landing in the locus where the divisor is composed by $d$ smooth distinct points (notice this locus is smooth over $\mathfrak M_{1,n}$ by the deformation theory of smooth subschemes). A morphism to $\PP^r$ shall now be thought of as a curve-divisor pair $(C,D)$ together with $r$ global sections of $\mathcal O_C(D)$: the morphism can be written as $[1:u_1:\ldots:u_r]$, where $1$ is the image of the constant global section along the given map $\mathcal O_C\to\mathcal O_C(D)$ (i.e. we have taken dishomogenised local coordinates on $\PP^r$).

Furthermore, \'{e}tale locally on $\M{1}{n}{\PP^r}{d}$, we may pick extra sections $\mathcal A$ and $\mathcal B$ of $\mathcal C_{1,n}(\PP^r,d)$ such that (i) they pass through the core elliptic curve, and (ii) they are disjoint smooth points away from $\mathcal D_0$. Then $\pi_*\mathcal L(\mathcal A)$ \emph{is} a vector bundle on $\mathfrak P_{1,n}$ and $\pi_*\mathcal L$ is carved inside it by requiring that the restriction (residue) map $\pi_*\mathcal L(\mathcal A)\to\pi_*\mathcal L(\mathcal A)_{|\mathcal A}$ is zero.

\begin{prop}
\emph{(1)} \'{E}tale locally, there is a locally closed embedding of $\M{1}{n}{\PP^r}{d}$ inside the vector bundle $V_1:=\Spec(\pi_*\mathcal L(\A)^{\oplus r})$ over $\mathfrak M_{1,n}^{\operatorname{div}=d}$. It is obtained by imposing the nondegeneracy and stability conditions \emph{(open)} on the vanishing locus of the restriction of the universal section of $\pi_*\mathcal L(\A)^{\oplus r}$ to $\A$ \emph{(closed)}.

\emph{(2)} Let $\mathcal V$ be an (affine local) \'{e}tale chart around a smooth point of $\mathfrak M_{1,n}^{\operatorname{div}=d}$. Then $\pi_*\mathcal L(\A)\cong \pi_*\mathcal L(\A-\B)\oplus \pi_*\mathcal \mathcal L(\A)_{|\B}$ (trivially, $\mathcal O_{\mathcal V}^{\oplus d+1}\cong\mathcal O_{\mathcal V}^{\oplus d}\oplus\mathcal O_{\mathcal V}$) and the restriction-to-$\A$ map is zero on the second factor. Call $\varphi\colon \pi_*\mathcal L(\A-\B)\to\pi_*\mathcal L(\A)_{|\A}$ the induced  restriction to $\A$.

\emph{(3)} If we choose a suitable basis of $\pi_*\mathcal L(\A-\B)$, the restriction-to-$\A$ map can be written in a very explicit form: let $D=\sum_{i=1}^d\delta_i$, then $\pi_*\mathcal O_{\mathfrak C}(\delta_i+\A-\B)$ is a sub-line bundle of $\pi_*\mathcal L(\A-\B)$ and $\varphi=\oplus\varphi_i\colon\oplus_{i=1}^d \pi_*\mathcal O_{\mathfrak C}(\delta_i+\A-\B)\to \pi_*\mathcal L(\A)_{|\A}.$ Furthermore $\varphi_i\colon\mathcal O_\mathcal V\to\mathcal O_\mathcal V$ is given (up to invertibles) by multiplication by $\prod_{q\in[\A,\delta_i]}\zeta_q$, where $\zeta_q$ is the smoothening variable on $\mathfrak M_1$ corresponding to the node $q$, and $q\in[a,\delta_i]$ stands for all the nodes separating $\A$ (i.e. the core elliptic curve) from the point $\delta_i$.
\end{prop}

Given these explicit equations and by carefully examining the proof of \cite[Prop. 4.13]{HL}, we can look back at the problem of determining the boundary of the main component of the space of stable maps. The following characterisation of smoothability was already known to (and partly proven in) \cite[Lem. 5.9]{Vre}.

\begin{prop}\label{smoothability_with_eqn}
Let $[f\colon C\to \PP^r]$ be a degenerate stable map from a ($n$-marked) genus one curve of the form $(E {}_{p_1,\ldots,p_m}\sqcup_{q_1,\ldots,q_m}\bigsqcup_{i=1}^m R_i,f)$, where $E$ is the maximal connected contracted arithmetic genus one subcurve, and $R_i$ are the rational tails (chains of $\PP^1$ along which $f$ has positive degree). The following are equivalent:
\begin{enumerate}
\item $[f]$ is smoothable;
\item $\operatorname{d}\!f(T_{q_i}R_i)$ are linearly dependent in $T_{f(E)}\PP^r$;
\end{enumerate}
\end{prop}
\begin{proof}
 Let us start with the easiest degenerate situation: a contracted elliptic curve joined with a rational tail of degree $d$ at a single node $q$. Equations for the moduli space of maps around such a point look like $\zeta_q\sum_{i=1}^d w_i^j=0$, for $j=1,\ldots,r$, the $w_i$'s being coordinates for $\pi_*\mathcal O_{\mathfrak C}(D+\A-\B)$ in the basis given by $\pi_*\mathcal O_{\mathfrak C}(\delta_i+\A-\B),\ i=1,\ldots,d$. Our point corresponds to a smoothable map if and only if the equations admit a solution with $\zeta_q\neq 0$, hence it must be $\sum_{i=1}^d w_i^j=0$ for every $j$. Taking a coordinate $z$ on the rational tail around the node $q$ (i.e. $\{z=0\}$ corresponds to the node), we see that the $i$-th vector in the chosen basis corresponds to a polynomial vanishing at the node and at every other point $\delta_j,\ j\neq i$; hence that can be written as $e_i(z)=z\prod_{j\neq i}\frac{(z-\delta_j)}{-\delta_j}$ (we chose a convenient normalisation). So the map corresponding to the point of coordinates $(w_i^j)_{i=1,\ldots,d;j=1,\ldots,r}$ can be represented as $[1:\sum_{i=1}^d w_i^1e_i(z):\ldots,\sum_{i=1}^d w_i^re_i(z)]$ on the rational tail; differentiating we see that the tangent vector at the node is sent to $(\sum_{i=1}^d w_i^1,\ldots,\sum_{i=1}^d w_i^r)$ (in affine coordinates), hence smoothability is equivalent to the image of the tangent vector being zero.
 
 More generally, we may assume the dual graph is terminally weighted. Let us say there are $m$ positive-weight rational tails and denote by $D(k),\ k=1,\ldots,m,$ the set of indices $j$ s.t. $\delta_j$ belongs to the $k$-th rational tail, by $E(k)$ the set of nodes separating the core genus one curve from the $k$-th rational tail. The equations have then the following form
 $$\sum_{k=1}^m(\prod_{q\in E(k)}\zeta_q)(\sum_{i\in D(k)}w_i^j)=0,\ j=1,\ldots,r$$
 which can be assembled in matrix form
 $$W\cdot\underline\zeta:=(\sum_{i\in D(k)}w_i^j)_{j,k}\cdot(\prod_{q\in E(k)}\zeta_q)_k=0.$$
 We see that smoothability is equivalent to linear dependence of the rows of the above matrix $W$. On the other hand, on every positive-weight rational tail $R_k$, we can choose a suitable coordinate $z_k$ around the node and write the map as $[1:p_k^1(z_k):\ldots:p_k^r(z_k)]$, where $p_k^j(z_k)=\sum_{i\in D(k)}w_i^je_i^k(z_k)$ and $e_i^k(z_k)=z_k\prod_{h\in D(k)\setminus\{i\}}\frac{(z_k-\delta_h)}{-\delta_h}$. The elliptic curve is contracted to the point $[1:0:\ldots:0]$ and the tangent vector to $R_k$ at the node is mapped to the $k$-th row of $W$ (in affine coordinates around that point). Again we see that the map is smoothable if and only if the image of the tangent vectors to the rational tails at the nodes are linearly dependent in $T_{f(E)}\PP^r$.
 \begin{comment}{
 Let us now address the equivalence of (1) and (3). Assume that we have a smoothing of a degenerate map $f_0\colon C_0\to\PP^r$
 \bcd
 \mathcal C\ar[d,"\pi"]\ar[r,"f"] & \PP^r\times S \\
 S &
 \ecd
 We may assume that $S$ is a DVR scheme. The line bundle $\mathcal L=f^*\mathcal O_{\PP^r}(1)\otimes\omega^{log}_{\mathcal C/S}$ is $S$-semiample: trivial on a subcurve of $C_0$ of arithmetic genus one, and ample everywhere else. Let's note that $\mathcal L$ is of  the form $\mathcal L=\omega_{\mathcal C/S}(E+\Sigma)$, where $E$ is the contracted genus 1 curve and $\Sigma$ is a Cartier divisor supported away from $E$. It follows from Smyth's contraction lemma \cite[Lemma 2.13]{SMY2} that $\mathcal L$ can be used to produce a smoothing family $\mathcal C'$ of a genus 1 Gorenstein singularity. The relative $\mathcal O(1)$ of the Proj construction defines a compatible morphism to $\PP^r$
 \bcd
 \mathcal C\ar[rr,"f"]\ar[dr]\ar[dd,"\pi"] & & \PP^r\times S\\
 & \mathcal C'=\underline{\operatorname{Proj}}_S(\sum_{n\geq 0}H^0(\mathcal C,\mathcal L^n)) \ar[ld,"\pi'"]\ar[ru,dashed,"f'"] & \\
 S & & 
 \ecd
Expressed in terms of $(2)$, we are saying that having dependent tangent vectors corresponds to the fact that the sections of $\mathcal L$ which define the morphism to $\PP^r$ descend to section on the Goreinstein singularity.
 Viceversa, assume $f_0$ factors through a Gorenstein singularity of genus one such that $f_0'\colon C_0'\to\PP^r$ is nondegenerate (i.e. it does not contract all the branches of the singularity). We can pick compatible smoothings of $C_0$ and $C_0'$:  
 \bcd
 \mathcal C\ar[rr,"\phi"]\ar[dr,"\pi" below=.1cm] & & \mathcal C'\ar[dl,"\pi'"]\\
 & S &
 \ecd
 The line bundle $L_0'=(f_0')^*\mathcal O_{\PP^r}(1)$ can be extended to a line bundle $\mathcal L'$ on $\mathcal C'$ because the Picard scheme for curves is unobstructed (and general theory of algebraisation of coherent sheaves on projective varieties); furthermore, the sections $u^0_0,\ldots,u^r_0$ can be extended to $\mathcal C'$ because $H^1(C_0',L_0')=0$ by Serre duality, the fact that $L_0'$ has positive degree on at least one of the branches of the singularity, and the fact that the dualising sheaf is trivial. Composing the resulting map $\mathcal C'\to \PP^r\times S$ with $\phi$ proves the desired smoothability of the original map.}
 \end{comment}
 \end{proof}

\subsection{Viscardi's compactifications}
For any homology class $\beta\in H_2(X,\mathbb Z)$, let $\mathcal M_{1,n}(X,\beta)$ be the stack of maps $f\colon C\to X$ from a smooth genus one curve with $n$ marked points, satisfying  $f_{*}\left [C\right ]=\beta$. The $m$-stable maps give compactifications of such a moduli space.
  \begin{dfn} Let $C$ be a reduced, connected, proper curve of arithmetic genus one, and let $p_1,\dots,p_n\in C$ be smooth, distinct points. A map $f\colon C\to X$ is said to be \emph{$m$-stable} if the following conditions hold:
\begin{enumerate}
 \item $C$ has only nodes and elliptic $l$-fold points, $l\leq m$, as singularities.
 \item For any connected subcurve $E\subset C$ of arithmetic genus one on which $f$ is constant, 
 \[|\left\{E\cap \overline{C\setminus E}\right\}\cup\left\{p_i : p_i \in E\right\}| > m.\]
 \item $f$ has no non-trivial infinitesimal automorphisms.
 \end{enumerate}
\end{dfn}
Recall that a $k$-rational $p\in C$ is called an \emph{elliptic $m$-fold point} if 
\[
\hat{\mathcal{O}}_{C,p}\cong
\begin{cases}
k[[x,y]]/(y^2-x^3) & \textit{if } m=1\\
k[[x,y]]/(x(x-y^2))& \textit{if } m=2\\
k[[x,y]]/ I_m & \textit{if } m\geq 3
\end{cases}
\] 
where $I_m=(x_hx_i-x_hx_j : i,j,h\in\left\{1,\dots,m-1\right\})$ and $i,j,h$ are distinct.

The definition of a family of $m$-stable maps is then the natural one and Viscardi's main result \cite[Thm. 3.6]{VISC} is that the associated moduli functor gives a compactification of $\mathcal M_{1,n}(X,\beta)$ (alternative to Kontsevich' moduli space).
\begin{thm}
The moduli functor of $m$-stable maps in a fixed homology class $\overline{\mathcal{M}}^m_{1,n}(X,\beta)$ is represented by a proper DM stack of finite type.
\end{thm}
\begin{remark}\label{remark:sprouting}
It seems to us that the algorithm presented by Viscardi to prove properness of the moduli space oversees a case. The problem is that, given a map $f\colon C\to\PP^r$ with $f$ constant on a genus one connected sub-curve $E\subseteq C$, it is not always true that $f$ descends to a map $f'\colon C'\to\PP^r$, where $C'$ is the singularity obtained from $C$ by contracting $E$. Indeed, it is likely that descending to $C'$ imposes differential conditions on $f$ that go beyond just order zero. A counterexample is the following.

Consider the stable map $[f]$ in $\overline{\mathcal M}_{1,0}(\PP^3,4)$ from an elliptic bridge $R_1\sqcup_{q_1}E\sqcup_{q_2} R_2$ to $\PP^3$ that maps $R_1$ to the $z$-axis, contracts $E$ to the origin, and makes $(R_2,q_2)$ into the normalisation of a cusp in the $(x,y)$-plane, i.e. its image is the non-Gorenstein singularity $C:=\mathbb C[x,y,z]/(x,y)\cap (z,y^2-x^3)$. 
Notice that $\operatorname{d}\!f(T_{q_2}R_2)=0$, so there is a non-trivial linear relation
\[0\cdot\operatorname{d}\!f(T_{q_1}R_1+1\cdot\operatorname{d}\!f(T_{q_2}R_2)=0\] and the map is smoothable; however, it is impossible to make the first coefficient non-zero and the map \emph{does not factorise} through an elliptic $m$-fold singularity. Indeed, the only chance would be to factorise through a birational map $f'\colon C'\to C$ from a tacnodal singularity $C'$. This is impossible since $C$ and $C'$ have the same $\delta$ invariant and so $f'$ would actually be an isomorphism. 
Observe that Viscardi suggests that the map should extend to the contraction, in a way that the image should still be $C$, since there is only one indeterminacy point (the singularity). We suggest that in this case the correct procedure would be to sprout $(R_1,q_1)$, but then there is actually no factorisation.

\begin{center}
\includegraphics[width=10cm,height=5cm]{cusp_line_transv.png}
\end{center}

However, the argument can easily be fixed. Let $(\mathcal{C}_\eta,F_{\eta})$ be a stable map to $\PP^r$, defined on the generic point of a DVR scheme $S$; we may assume that $\mathcal C_{\eta}$ is smooth \cite[Section~3.2.1]{VISC}. 
As described in \cite[Step~1, Theorem~3.6]{VISC}, after applying nodal reduction we get a map $F\colon\mathcal C_S\to\PP^r_{S}$, for which we may suppose that $C_0$ is nodal and $f:=F_0$ is stable.

If $f$ is not constant on the minimal genus one sub-curve \cite{SMY1}, then it is also $m$-stable and there is nothing to say. Otherwise, let $E\subset C$ be the maximal connected genus one sub-curve where $f$ is constant and let $R_1\sqcup\dots\sqcup R_m=\overline{C/E}$.
 By Proposition~\ref{prop:components}(2) we know there is a non-trivial linear relation among the $\operatorname{d}\!f(T_{q_i}R_i)$'s.
 %In other words, the first derivatives of the sections $s_0,\dots,s_r$ defining $f$, satisfy a non trivial linear relation around $q_1,\dots,q_m =E\cup\bar{C/E}$.
 There are two possible situations:
 \begin{enumerate}
 \item $\operatorname{d}\!f(T_{q_i}R_i)\neq 0$ for every $i=1,\ldots,m$. Possibly after relabelling, this non-trivial relation looks like
 \[\alpha_1\operatorname{d}\!f(T_{q_{1}}R_{1})+\ldots +\alpha_j \operatorname{d}\!f(T_{q_{j}}R_{j})=0\]
  with all the coefficients being non-zero. Then, we may blow-up $\mathcal{C}$ in $q_{j+1},\ldots, q_m$. The induced map $\tilde{F_0}$ is constant on the exceptional divisors $E_{j+1},\ldots, E_m$, so we can complete the above linear relation to 
 \[\alpha_1\operatorname{d}\!\tilde f(T_{q_{1}}\tilde R_{1})+\ldots +\alpha_j \operatorname{d}\!\tilde f(T_{q_{j}}\tilde R_{j})+\beta_{j+1}\operatorname{d}\!\tilde f(T_{q_{j+1}}E_{j+1})+\ldots+\beta_m\operatorname{d}\!\tilde f(T_{q_{m}}E_m)=0\]
  with any choice of non-zero coefficients $\beta$. Now this \emph{sprouting} \cite[Section 2.3]{SMY2} ensures that the sections descend to the corresponding elliptic $m$-fold singularity. At this point, go to Step~2 of Viscardi's algorithm and follow it.
\item  
$\operatorname{d}\!f(T_{q_i}R_i)=0$ for some $i$, say for $i\in\left\{1,\dots,j\right\}$. 
 Then blow-up $\mathcal{C}$ at $q_{j+1},\ldots, q_m$. Observe that all $\operatorname{d}\!\tilde f(T_{q_i}R_i),\ i=1,\ldots,j$ and $\operatorname{d}\!\tilde f(T_{q_i}E_i),\ i=j+1,\ldots,m$ vanish, hence they satisfy any linear relation with non-zero coefficients, and they factorise through the corresponding singularity. The map has positive degree on the first $i=1,\ldots,j$ branches.
 \end{enumerate}
\end{remark}

The irreducible components of Viscardi's moduli space $\overline{\mathcal{M}}^m_{1,n}(\PP^r,\beta)$ are well understood too \cite[Thm.~5.9]{VISC}; indeed they have a similar description to the ones of Kontsevich' space. The main advantage of the $m$-stable compactification is that the number of components drops as $m$ increases.
 \begin{cor}\cite[Cor.~5.10]{VISC}
 For $m\geq\operatorname{min}(r,d)+n$, $\overline{\mathcal{M}}^m_{1,n}(\PP^r,\beta)$ is irreducible.
 \end{cor}


 Moreover, inspired by Viscardi's alternate compactification, we express a sufficient condition for smoothability in yet another way.
 \begin{prop}
Let $[f\colon C\to \PP^r]$ be a degenerate stable map from a ($n$-marked) genus one curve of the form $(E {}_{p_1,\ldots,p_m}\sqcup_{q_1,\ldots,q_m}\bigsqcup_{i=1}^m R_i,f)$, where $E$ is the maximal connected contracted arithmetic genus one subcurve, and $R_i$ are the rational tails (chains of $\PP^1$ along which $f$ has positive degree). 
 If $f$ factorises through a \emph{non-degenerate} (i.e. having positive degree along at least one of the branches of the singularity) map $f'\colon C'\to\PP^r$ from an elliptic $k$-fold singularity, with $k\leq m$, then  $\operatorname{d}\!f(T_{q_i}R_i)$ are linearly dependent in $T_{f(E)}\PP^r$.
 \end{prop}
 \begin{proof}
 Let $\xymatrix{C\ar[r]^{\pi} &C'\ar[r]^{f'} &\PP^r}$ be the factorization of $f$. Then $E'=\operatorname{Exc}(\pi)\subseteq E$ and 
  $\overline{C\setminus E'}=(S_1,q'_1)\sqcup\dots\sqcup (S_k,q'_k)\to (C',p)$ 
  is the normalization of the elliptic $k$-fold point. By hypothesis, $f=f'\circ\pi$ and $f$ is non-constant on $R_1,\dots R_m.$ Being $f'$ non-degenerate implies that there exists a subset
  $\left\{S_1,\ldots S_j\right\}\subseteq\left\{S_1,\ldots S_k\right\}$ 
  such that \[(S_1,q'_1)\cong (R_{i_1}, q_{i_1}),\ldots, (S_j,q'_j)\cong (R_{i_j}, q_{i_j}),\;\;\left\{i_1,\dots,i_j\right\}\subseteq \left\{1,\dots,m\right\}.\] 
By Smyth's characterisation of elliptic $k$-fold singularities, \cite[Lem.~2.2]{SMY1}, we obtain a non trivial linear relation 
  \begin{equation*}
  \label{eq:dep}\alpha_1\operatorname{d}\!\pi(T_{q_{i_1}}R_{i_1})+\ldots+\alpha_j \operatorname{d}\!\pi(T_{q_{i_j}}R_{i_j})+\alpha_{j+1}\operatorname{d}\!\pi(T_{q_{j+1}}S_{j+1})+\ldots+\alpha_k \operatorname{d}\!\pi(T_{q_k}S_k)=0
  \end{equation*}
  since all the coefficients are non-zero, $j\neq0$, and the second half of the formula can be ignored, we've got what we wanted.
  \end{proof}
\begin{rem}\label{remark:cuspunionline} 
The viceversa is not true, as Remark \ref{remark:sprouting} shows.
\end{rem}

In order to achieve the original goal of Gromov-Witten theory, i.e. the enumeration of smooth curves of genus $g$ in a target variety, mathematicians have been trying either to eliminate the unwanted components of Kontsevich's space (e.g. degenerate contributions from lower genus curves and multiple covers of lower degree curves) by defining alternate compactifications, or to concentrate the attention on the main component (i.e. find a suitable fundamental class supported on it). In genus one, Vakil and Zinger managed to do so by performing a sequence of blow-ups on an underlying space of weighted curves \cite{VZpreview} \cite{VZ} (see also \cite{HL}). The idea is that blowing up successively the locus of degree zero elliptic curve with one rational tail (\emph{elliptic tails}), then with two (\emph{elliptic bridges}), etc. and taking the fiber product
\bcd
\widetilde{\mathcal M}_{1,n}(\PP^r,d)\ar[r]\ar[d] & \M{1}{n}{\PP^r}{d}\ar[d] \\
\widetilde {\mathfrak M}_{1,n}^{\operatorname{wt}=d} \ar[r] & \mathfrak M_{1,n}^{\operatorname{wt}=d}
\ecd
the strict transform of the main component becomes smooth and meets the rest of the components in normal crossing fashion (the \'{e}tale local model being the union of two linear subspaces of different dimensions in affine space). Furthermore, the sheaves $\tilde\pi_*\tilde f^*\mathcal O_{\PP^r}(l)$ contain a vector subbundle of rank $dl$ supported on the strict transform of the main component. This paved the way to the definition of reduced invariants.
\begin{dfn}
Let $X$ be a complete intersection of degree $(l_1,\ldots,l_k)$ in $\PP^r$. The genus one \emph{reduced} Gromov-Witten invariants of $X$ are defined by integration on $$[\widetilde{\mathcal M}_{1,n}(\PP^r,d)^\circ]\cap c_{\operatorname{top}}(\tilde\pi_*\tilde f^*(\oplus_{i=1}^k\mathcal O_{\PP^r}(l_i))^\circ).$$
\end{dfn}

It is a matter of fact that the virtual dimension of the moduli space of maps to a three-fold $X$ is independent of the genus. In this context it was plausible to test the better enumerative properties of reduced invariants; in fact, Li-Zinger \cite{LZ} in the symplectic category and, later on, Chang-Li \cite{CL} in the algebraic one, proved a comparison formula for the quintic three-fold $X_5\subseteq\PP^4$ (or, more generally, for a complete intersection three-fold $X$ of degree $(l_1,\ldots,l_k)$ in $\PP^r$ with $\sum l_i\leq r+1$) of the form
$$GW_1(X)=\widetilde{GW}_1(X)+c\cdot GW_0(X).$$
We notice that the genus zero contribution to this formula comes from the boundary component with a single rational tail of degree $d$, while elliptic bridges and degenerate contributions with more rational tails do not matter to the genus one Gromov-Witten count. This suggests that removing the component with elliptic tails would provide a more direct and efficient definition of reduced invariants. We plan to do so by comparing the ordinary space of stable maps with Viscardi's space of 1-stable maps.

\section{Cuspidal curves and maps}

In this section we start investigating the Gromov- Witten type invariant obtained from Viscardi compactification studying the case $m=1$: the source curve is at worst cuspidal. We will see how in this case we can give a comparison with the GW-invariant and explain why the same technique does not work for higher $m$.
The first thing we do is the following:
we introduce a moduli space of stably-weighted, prestable, at worst cuspidal, marked curves. We show that there is a birational morphism from a correspondingly decorated moduli space of prestable nodal curves. Taking the fiber product with Viscardi's moduli space of stable cuspidal maps, we show that the resulting space includes in the usual Kontsevich's moduli space, precisely avoiding the component with elliptic tails $D_{\{d\},\{n\}}(X,d)$.

Why should such a morphism on decorated prestable curves exist? 
Consider an elliptic tail $C$; a one-dimensional family $\mathcal C$  with central fiber $\mathcal C_0\cong C$ will either be locally constant or smoothen the node. In the first case we can associate to this the locally constant family of cusps obtained by forgetting the elliptic tail and contracting a length-two infinitesimal neighborhood of the node in the rational component; in the second case, we claim that the line bundle $\mathcal O_\mathcal C(3q)$ gives a morphism to a smoothing of the cuspidal $\PP^1$. This heuristics (i.e. being able to substitute an elliptic tail with a cusp over points or DVR schemes) motivates us to believe we can define a morphism from suitably defined moduli spaces of nodal genus one curves to cuspidal curves (cfr. \cite[Lemma 4.2]{SMY2}). In fact we shall extend \cite[Corollary 4.5]{SMY2} to an appropriate setup of moduli stacks of weighted prestable curves. Assume $d>0$ throughout the following.

\begin{dfn}
Let $\mathfrak M_{1,n}^{\operatorname{wt}=d,\text{st}}$ be the stack of \emph{prestable} (projective, nodal and reduced), connected, arithmetic genus one, $n$-marked curves that are \emph{stably weighted} with total weight $d$, i.e. for every geometric point there is an integer-valued function on the set of irreducible components of the corresponding curve, such that it is compatible with specialisation maps and the sum of the integers is $d$; furthermore we require that all integers are nonnegative and every $p_a=0$ weight-0 component has at least three special points (every $p_a=1$ weight-0 component has at least one special point).
\end{dfn}
Remark that there is an \'{e}tale, non-separated morphism $\mathfrak M_{1,n}^{\operatorname{wt}}\to\mathfrak M_{1,n}$ and the weight stability condition is such that the forgetful map $\M{1}{n}{\PP^r}{d}\to\mathfrak M_{1,n}$ factorises through $\mathfrak M_{1,n}^{\operatorname{wt}=d,\text{st}}$, the weight assignment coming from the degree of the map to $\PP^r$.

\begin{dfn}
Let $\mathfrak M_{1,n}^{\operatorname{wt}=d,\text{st}}(1)$ be the stack of \emph{at worst cuspidal} projective, reduced, connected, arithmetic genus one, $n$-marked curves that are stably weighted with total weight $d$, i.e. as above with (stricter) stability condition: every $p_a=0$ weight-0 component has at least three special points (every $p_a=1$ weight-0 component has at least \emph{two} special point) \emph{and} every weight-0 cusp has at least two further special points.
\end{dfn}

Note that the only type of nodal curves that we are getting rid of is the one with an elliptic tail of weight zero.

\begin{thm}
There exists a morphism $\mathfrak M_{1,n}^{\operatorname{wt}=d,\text{st}}\to\mathfrak M_{1,n}^{\operatorname{wt}=d,\text{st}}(1)$ which extends the identity on the smooth locus.
\end{thm} 
We approach the proof in two different manners: first we adopt the strategy of constructing the graph of such morphism and prove that projection on the source is an isomorphism; second we construct the $1$-stabilisation at the level of curves with divisors with an argument \'{a} la Hassett \cite{HassettHyeon}, then argue that it descends to a morphism between moduli spaces of weighted curves.

\subsection{First approach: the graph}

Let $\mathcal C$ and $\mathcal C'$ be the universal curves over $\mathfrak{M}:=\mathfrak M_{1,n}^{\operatorname{wt}=d,\text{st}}$ and $\mathfrak{M}':=\mathfrak M_{1,n}^{\operatorname{wt}=d,\text{st}}(1)$ respectively. Abusing notation, we will still write $\mathcal C$ and $\mathcal C'$ for their pullbacks to the product $\mathfrak{M}\times\mathfrak{M}'$ along the two projections. The proof of the theorem follows from two Lemmas:

\begin{lem}\label{lemma:def_X}
 There is a locally closed substack $\mathcal X\subseteq\operatorname{Mor}_{\mathfrak{M}\times\mathfrak{M}'}(\mathcal C,\mathcal C')$ representing morphisms $C\to C'$ that contract weight-zero elliptic tails to cusps and are weight-preserving isomorphisms everywhere else. 
\end{lem}

\begin{lem}\label{lamma:projection_iso}
 The first projection $\pr_1\colon \operatorname{Mor}_{\mathfrak{M}\times\mathfrak{M}'}(\mathcal C,\mathcal C')\to\mathfrak M$ restricted to $\mathcal X$ is an isomorphism with $\mathfrak M$.
\end{lem}

\begin{proof}\ref{lemma:def_X}
Recall that $\operatorname{Mor}_{\mathfrak{M}\times\mathfrak{M}'}(\mathcal C,\mathcal C')$ is an algebraic stack; in fact the map to $\mathfrak{M}\times\mathfrak{M}'$ is representable (by algebraic spaces) \cite{OlssonHOM}. We now proceed to construct $\mathcal X$ as a locally closed substack in the space of morphisms.

\begin{description}[labelindent=0cm,leftmargin=\parindent]

\item[Step 1] Consider
 \[\pi\colon\mathfrak{P}=\mathfrak{Pic}^{tot deg=d,st}_{1,n}\to\mathfrak{M},\ \pi'\colon\mathfrak{P}'=\mathfrak{Pic}^{tot deg=d,st}_{1,n}(1)\to\mathfrak{M}'\]
  the Picard stacks of $\cC\to\mathfrak{M}$ and $\cC'\to\mathfrak{M'}$ with universal line bundles $\mathfrak{L}$ and $\mathfrak{L'}$, where $\pi$ and $\pi'$ are defined by taking the multi-degree of line bundles. We can now look at the algebraic stack $\operatorname{Mor}_{\mathfrak{P}\times\mathfrak{P}'}(\mathcal C,\mathcal C')$ with universal morphism
 $\Phi$ and natural projection $\Pi$ to $\operatorname{Mor}_{\mathfrak{M}\times\mathfrak{M}'}(\mathcal C,\mathcal C')$. We claim that there exists a locally closed substack $\mathcal{Y'}\subseteq \operatorname{Mor}_{\mathfrak{P}\times\mathfrak{P}'}(\mathcal C,\mathcal C')$ representing those morphisms that \emph{preserve the line bundles}. Indeed, given a chart 
 \begin{equation*}%\label{equation:Spoints} 
 S\to\operatorname{Mor}_{\mathfrak{P}\times\mathfrak{P}'}(\mathcal C,\mathcal C'),
  \end{equation*} 
   the locus of $s\in S$ where $\Phi_s^*\mathfrak{L}'_s\cong\mathfrak{L}_s$ is nothing else than the locus $T$ where the two sections $\mathfrak{L}_S$ and $\Phi_S^*\mathfrak{L}'_S$ of $\mathfrak{P}(S)\to\mathfrak{M}(S)$ coincide. In other words, we are looking at the fiber product 
  \[\xymatrix{T\ar[r]\ar[d]&\mathfrak{P}\ar[d]^{\Delta}\\
  S\ar[r]&\mathfrak{P}\times_{\mathfrak{M}}\mathfrak{P}}\]
Being $\mathfrak{P}\to\mathfrak{M}$ representable by locally separated algebraic spaces \cite[Theorem~8.3.1]{neron}, $\Delta$ is a quasi-compact locally closed immersion \cite[\href{http://stacks.math.columbia.edu/tag/04YU}{Tag 04YU}]{stacks-project}, so in particular $T\subseteq S$ is locally closed.

\item[Step 2] 
Furthermore there is a closed substack $\mathcal Y\subseteq \mathcal Y'$ representing \emph{surjective morphisms that preserve the markings}.

Given a chart $S\to\operatorname{Mor}_{\mathfrak{P}\times\mathfrak{P}'}(\mathcal C,\mathcal C')$, the locus of $s\in S$ where $\Phi_s$ is marking-preserving is the equaliser of the two sections
\bcd
S \ar[r,shift left, "\times\sigma_i'" above]\ar[r,shift right,"\times\Phi\circ\sigma_i" below] & \mathcal C_S'\times_S\ldots\times_S \mathcal C_S'
\ecd
This defines a closed subscheme of $S$, since $\mathcal C_S'\to S$ is separated.

As regards surjectivity, since $\Phi$ is proper and the dimension of the fiber is upper semicontinuous \cite[\href{http://stacks.math.columbia.edu/tag/0D4I}{Tag 0D4I}]{stacks-project}, the locus in $\mathcal C_S'$ where the fiber of $\Phi$ is empty is open. Its image in $S$ is open by flatness of $\cC'\to S$ \cite[\href{http://stacks.math.columbia.edu/tag/01UA}{Tag 01UA}]{stacks-project}, and the complement of it is the locus we need.
 
\item[Step 3] Let $\mathcal{X}'$ be the image of $\mathcal Y$ under $\Pi$. This is a constructible substack of $\operatorname{Mor}_{\mathfrak{M}\times\mathfrak{M}'}(\mathcal C,\mathcal C')$ by Chevalley's theorem \cite[Theorem 5.9.4]{LMB}. Recall that to show that a constructible set is open (respectively closed) it is enough to check that it contains all the generisations of its points (respectively all the specialisations) \cite[\href{http://stacks.math.columbia.edu/tag/0DQN}{Tag 0DQN}\href{http://stacks.math.columbia.edu/tag/0903}{Tag 0903}]{stacks-project}. Finally, under Noetherian assumptions, two points related by specialisation/generisation are contained in the image of a DVR scheme \cite[\href{http://stacks.math.columbia.edu/tag/054F}{Tag 054F}]{stacks-project}.

It is clear that being surjective and marking-preserving are closed conditions, as above. The requirement that $\phi$ can be covered by a line bundle-preserving map can be translated into the following combinatorial conditions:

\begin{enumerate}
\item\emph{$\phi$ contracts only weight zero components.} We show that this is open. Assume that $S$ is a DVR scheme with closed point $0$ and generic point $\eta$, and we are given $S\to\mathcal X'$ such that $\phi_0\colon\mathcal C_0\to \mathcal C_0'$ does not contract any positive weight component. Suppose there exists an irreducible component $D_\eta\subseteq C_{\eta}$ of positive weight $d_W$ which is contracted by $\phi_{\eta}.$ The contracted locus, i.e. $\left\{c\in \mathcal{C}_{S} | \dim_c\phi^{-1}(\phi(c))\geq 1\right\}$, is closed by semicontinuity of fiber dimension, hence it contains all the components $D_i\subseteq C_0$ to which $D_\eta$ specialises. At least one of them has positive weight, since the sum of their weights is $d_W$, which is a contradiction.

\item\emph{$\phi$ has degree 1 on every non contracted component} or, equivalently, there is an $S$-dense open in $\mathcal C'_S$ such that the restriction of $\phi_S$ to its preimage is an isomorphism.
This is an open and closed condition; we show it is open. Let $S$ be a DVR scheme as above and assume that $\phi_0$ satisfies the property. Since $\phi_S$ is proper, we may consider 
\[\phi_{S,*}[\mathcal C_{S}]=\sum n_i[\mathcal C'_{S,i}]\in A_2(\cC'_S)\]. Applying Gysin pull-back to $0$ (which is a regular closed point of the base) \cite[Prop. 10.1(a)]{FUL}, we see that all the $n_i$'s are 1 for those $\cC'_i$'s such that $0^![\cC'_i]\neq 0$. On the other hand there is no irreducible component of $\cC'$ supported on $\cC'_\eta$.

\item\emph{$\phi$ is weight-preserving.} This is again an open condition, as we can see from the weighted dual graphs. Let $\tilde \phi$ be the map induced at the level of weighted dual graphs $\Gamma(\cC)\to\Gamma(\cC')$. It is compatible with the specialisation maps:
\bcd
\Gamma(\cC_0)\ar[r,"\tilde\phi_0"]\ar[d,"\rm{sp}"] & \Gamma(\cC'_0)\ar[d,"\rm{sp}"] \\
\Gamma(\cC_{\eta})\ar[r,"\tilde\phi_\eta"]& \Gamma(\cC'_\eta)
\ecd
Since the weight of a component of the generic fiber is determined by those of the components to which it specialises
\[ \deg(v)=\sum_{w\in\rm{sp}^{-1}(v)}\deg(w)
\]
$\tilde{\phi}_\eta$ has to be weight-preserving as well.
\end{enumerate}

\item[Step 4] We have seen that, if $\phi$ contracts a connected subcurve $E$ of the fiber, it must have zero weight. Since the target only has nodes and cusps as singularities, and the markings are required to be smooth points, we observe that $E$ must be of arithmetic genus one by weighted stability and $|\overline{C\setminus E}\cap E|\leq 2$, i.e. $E$ is either an elliptic tail or an elliptic bridge. There are basically two possibilities:
\begin{enumerate}
\item $\phi$ contracts an elliptic tail to a cusp and is an isomorphism everywhere else, or there is no elliptic tail to start with and $\phi$ is an isomorphism;
\item the elliptic tail/bridge is contracted to a smooth point/node, then a non-separating node or a cusp must be created somewhere else in order to preserve the arithmetic genus.
\end{enumerate} 
We want to avoid the second scenario, so we define the open substack $\mathcal X\subseteq \mathcal X'$ as follows.
Given $\mathcal{C}_S\to\mathcal C_S'\in\mathcal X'(S)$, let $U'\subseteq \mathcal C'$ be the \emph{maximal} $S$-dense open subset such that $\phi_S|_{\phi_S^{-1}(U')}\colon\phi_S^{-1}(U')\to U'$ is an isomorphism and $Z'$ its closed complement in $\mathcal C_S'$. 
Then $\mathcal X$ is the open locus \cite[\href{http://stacks.math.columbia.edu/tag/055G}{Tag 055G}]{stacks-project} where the fibers of $\pi|_{\phi^{-1}(Z')}\colon \phi^{-1}(Z')\to S$ are geometrically connected.
\end{description} 
 \end{proof}
 
 \begin{proof}\ref{lamma:projection_iso}
 This result will follow from an application of Zariski's Main Theorem for algebraic spaces.
First we claim that the projection is \emph{representable by algebraic spaces}: by \cite[\href{http://stacks.math.columbia.edu/tag/04Y5}{Tag 04Y5}]{stacks-project} we only need to check that it is faithful, and by \cite[Theorem 2.2.5]{CONR} it is enough to look at geometric points. Hence we need to say that, given $\phi\colon C\to C'$ a $k$-point of $\X$, we have
$\operatorname{Aut}(\phi)\subseteq\operatorname{Aut}(C)$. Recall that automorphisms of $\phi$ are commutative diagrams:
\bcd C\ar[r,"\phi"]\ar[d,"\psi"] & C'\ar[d,"\psi'"] \\ C\ar[r,"\phi"] & C' \ecd
 Now $\psi'$ is determined by $\psi$ due to our description of $\phi$.
 
Secondly $\pr_{1|\mathcal X}$ is \emph{proper}: this can be seen using the valuative criterion
\bcd
\eta'=\Spec(K')\ar[r]\ar[d] & \eta=\Spec(K)\ar[r]\ar[d] & \mathcal X \ar[d] \\
S'=\Spec(R')\ar[r]\ar[urr,dashed,"\exists?", left] & S=\Spec(R)\ar[r] & \mathfrak M
\ecd
Let $\pi \colon \mathcal C_S\to S$ be the family of nodal curves on $S$; there are three cases to consider:
\begin{enumerate}
\item the central fiber contains no elliptic tail, then the same is true for $\mathcal C_\eta$, hence $\phi_\eta$ is an isomorphism. We can extend $\phi_\eta$ as follows:
\bcd
\cC_\eta\arrow{r}{\sim}[swap]{\phi_\eta}\ar[d,hook,"\iota"] & \cC'_\eta\ar[d,hook,"\iota\circ\phi_\eta^{-1}"] \\
\cC_S\ar[r,"\id_\cC"] & \cC_S=:\cC'_S
\ecd
Another extension $\phi'\colon \mathcal C_S\cong \mathcal C_S'$ would be isomorphic to the previous one via:
\bcd
\cC_S\ar[r,"\phi'"]\ar[d,"\id"] &\cC_S'\ar[d,"(\phi')^{-1}"] \\
\cC_S\ar[r,"\id"] & \cC_S
\ecd

\end{enumerate}
If instead $\mathcal C_0$ has got an elliptic tail, then we have two possibilities:
\begin{enumerate}
\setcounter{enumi}{1}
\item $\mathcal C_{\eta}$ has an elliptic tail as well; that is the image of $S\to\MM$ is contained in the boundary, so we can find a lift
\bcd
 & \MM_{1,1}\times\MM_{0,1+n}^\text{wt}\ar[d] & \\
 S\ar[r]\ar[ur,dashed] & \mathfrak D_{\{1,\emptyset\},\{0,n\}}\ar[r,hook] &\MM.
\ecd
 Then $\mathcal C_S$ is the push-out of a family of rational curves $\mathcal R_S$ and a family of genus one curves $\mathcal Z_S$:
%The map $S\to\partial \mathfrak M_{1,n}$ lifts to the normalisation of the boundary, i.e. $\mathfrak M_{0,n_0+1}\times\mathfrak M_{1,n_1+1}$, which gives two families of pointed curves on $S$; there is a map from the push-out to $\mathcal C_S$ by the universal property, and it is proper bijective and flat (crit\`{e}re de platitude par fibres \cite[\href{http://stacks.math.columbia.edu/tag/039A}{Tag 039A}]{stacks-project}).
\begin{equation}\label{eq:pushout}
\begin{tikzcd}
S\ar[d]\ar[r] & \mathcal R_S \ar[d] \\
\mathcal Z_S\ar[r] & \mathcal C_S
\end{tikzcd}
\end{equation}
Recall that the cuspidal curve $\cC'_K$ can be characterised as the push-out of the following diagram:
\bcd
2K\ar[r]\ar[d] & \mathcal R_K\ar[d] \\
K\ar[r] & \mathcal C'_K.
\ecd
Since the smooth section $S\to\mathcal R_S$ defines a Cartier divisor, it makes sense to take its double and we can thus define $\cC'_S$ by means of the similar diagram:
\bcd
2S\ar[r]\ar[d] & \mathcal R_S\ar[d] \\
S\ar[r] & \mathcal C'_S
\ecd
The morphism $\phi_S\colon\cC_S\to\cC'_S$ extending $\phi_\eta$ is then defined by exploiting the description of $\cC_S$ as a push-out \eqref{eq:pushout}, and the morphisms $\id\colon\mathcal R_S\to \mathcal R_S$ and $\pr_{\mathcal Z_S}\colon\mathcal Z_S\to S$.
\item If $\mathcal C_S$ smoothens the elliptic tail, then $\phi_\eta$ is an isomorphism. We may assume that $S$ is the spectrum of a complete DVR with algebraically closed residue field \cite[Theorem 7.10]{LMB}. Then we may pick one smooth section for each rational component of $\cC_0$ and extend them to sections of $\cC_S\to S$ by Grothendieck's existence theorem; let us denote by $\Sigma$ the Cartier divisor that is the sum of all such sections. Let $Z$ be the elliptic tail in the central fiber; then we claim that $\omega_{\cC_S/S}(Z)\otimes\mathcal O_{\cC_S}(\Sigma)$ is $\pi_S$ semi-ample, ample on the generic fiber, and gives the contraction of the elliptic tail to the cusp in the central fiber. We shall not prove the claim here, since this is the core of the second approach.
\end{enumerate}
Finally, observe that the map is bijective by construction and $\mathfrak M$ is normal, hence $\pi_{|\mathcal X}\colon\mathcal X\to \mathfrak M$ is an isomorphism by Zariski's main theorem (as in \cite[\href{http://stacks.math.columbia.edu/tag/082I}{Tag 082I}]{stacks-project}).
 \end{proof}
 
\subsection{Second approach: constructing the contraction}

The idea of this construction is essentially due to Hassett \cite[\S2]{HassettHyeon} and it has recently been reviewed and simplified in \cite[\S3.7]{RSPW}.

Let $\mathfrak{P}=\mathfrak{Pic}^d_{\cC/\MM_1}$ with the stability condition that 
\[\omega_\pi\otimes \mathcal L^{\otimes 3}\]
 is $\pi$-ample. We work over $\MM_1^{\rm{div}}$, parametrising families of nodal curves with a relative Cartier divisor. More precisely, this can be thought of as the open inside $C(\pi_*\mathcal L)=\Spec_\pP(\R^1\pi_*\mathcal L)$ (see \cite{CLpfields}), where the section is not $0$ on any irreducible component of the curve. Alternatively one can think of the moduli functor of a line bundle with a section up to scalar as the hom-stack $\Hom_{\MM_1}(\C,[\Aaff^1/\Gm])$, again requiring the section not to be $0$ and the total degree of the line bundle to be $d$.

We shall first construct the contraction over $\MM^{\rm{div}}$ and then show that it descends to $\MM^{\rm{wt}}$.

Let $E$ be the locus inside the universal curve spanned by elliptic tails; this is a Cartier divisor in the universal curve over $\MM^{\rm{wt}}_1$, which we shall freely pullback and keep denoting by $E$. We shall also denote by $\mathfrak D^1$ its image in $\MM^{\rm{wt}}_1$ (and its various pullbacks), which is a Cartier divisor as well.

We write 
\begin{equation}\label{eq:linebundlecontraction}
\mathcal N:=\omega_{\pi}(E)\otimes\mathcal O_{\cC}(3D),
\end{equation} where $D$ is the universal Cartier divisor over $\MM_1^{\rm{div}}$ (so $\mathcal O_{\cC}(D)$ is the pullback of the universal line bundle on $\pP$).
Notice that $\mathcal N$ is trivial on the locus of elliptic tails, so if the contraction morphism is well defined it will contract this locus.

\begin{prop}\label{1-stabilization-div}
 The $1$-stabilisation $\MM_1^{\rm{div}}\to\MM_1^{(1),\rm{div}}$ is defined by the line bundle $\mathcal N$:
 \bcd
 (\cC,D)\ar[rr,"\phi"]\ar[dr,"\pi"] & & (\hat\cC=\operatorname{Proj}_{\MM_1^{\rm{div}}}(\bigoplus_{n\geq 0}\pi_*\mathcal N^{\otimes n}),\phi(D))\ar[ld,"\hat\pi"] \\
 & \MM_1^{\rm{div}} &
 \ecd
\end{prop}

We shall prove this proposition through a series of lemmas. The first one is a technical tool drawn from \cite{RSPW}: it implies that the $\Proj$ construction we perform commutes with base change to generically chosen curves inside $\MM_1^{\rm{div}}$. In the following it will allow us to check that $\mathcal N$ is semi-ample and that $\pi_*\mathcal N$ is locally free assuming that $\cC\to T$ is a smoothing over the spectrum of a discrete valuation ring.

\begin{lem}[pullback with a boundary]\label{DVR}
Let $\pi\colon\cC\to S$ be a proper family of curves over a smooth basis, and let $\mathcal N$ be a line bundle on $\cC$ such that $\R^1\pi_*\mathcal N$ is a line bundle supported on a Cartier divisor $\mathfrak D\subseteq S$. Then for every $T$ the spectrum of a DVR with closed point $0$ and generic point $\eta$, and for every morphism $f\colon T\to S$ such that $f(0)\in\mathfrak D$ and $f(\eta)\in S\setminus\mathfrak D$ we have
\[f^*\pi_*\mathcal N\cong \pi_*f^*\mathcal N.\]
%We have denoted with $\mathfrak{D}^1$ the Cartier divisor image of the locus spanned by elliptic tails.
\end{lem}
\begin{proof}
The argument can be found in \cite[Lemmma~3.7.2.2]{RSPW}.
\begin{color}{gray}{
Let $K^{\bullet}$ the complex of locally free sheaves on $S$ which satisfy cohomology and base change, i.e. such that for any $T\xrightarrow{f} S$  we get
$H^i(f^*K^{\bullet})=\R^i\pi_*f^*\mathcal M.$ The construction of $K^{\bullet}$ is standard, (see e.g. \cite[Proposition~12.2]{HAR} and since the cohomology is concentrated in degree 0,1, we can assume $K^{\bullet}=K_0\to K_1.$ Let $f$ be the map defined in the statement of the Lemma.
Then we have the following exact sequences:
\begin{equation}\label{eq:exact1}
0\to \pi_*\mathcal M\to K^0\to K^1\to \R^1\pi_*\mathcal M\to 0,
\end{equation}
\begin{equation}\label{eq:exact2}
0\to \pi_*f^*\mathcal M\to f^*K^0\to f^*K^1\to \R^1\pi_*f^*\mathcal M\to 0.
\end{equation}
The derived pull-back $Lf^*$ of the complex~\eqref{eq:exact1} is zero since the complex is exact. Writing down explicitly the spectral sequence which compute the derived pull-back, we find that its convergence to zero implies that:
\begin{align*}
\operatorname{coker}(f^*\pi_*\mathcal M\to\pi_*f^*\mathcal M)&\cong \rm{L}_1f^*\R^1\pi_*\mathcal M\\
\operatorname{ker}(f^*\pi_*\mathcal M\to\pi_*f^*\mathcal M)&\cong \rm{L}_2f^*\R^1\pi_*\mathcal M.
\end{align*} 
To prove that $\rm{L}_if^*\R^1\pi_*\mathcal M=0$ for $i=1,2$ it is enough to work locally on $S$, where we have a free resolution for  of the form $\R^1\pi_*\mathcal M$ of the form:
\[0\rightarrow \OO_S\xrightarrow{g}\OO_S\rightarrow \R^1\pi_*\mathcal M\rightarrow 0\] 
and thus pulling back along $f$
\[0\rightarrow  \rm{L}_1f^*\R^1\pi_*\mathcal M \to \OO_T\xrightarrow{f^*g}\OO_T\rightarrow f^*\R^1\pi_*\mathcal M\rightarrow 0.\] 
It immediately follows that $ \rm{L}_2f^*\R^1\pi_*\mathcal M=0.$ Finally notice that since the image of $f$ is not contained in the boundary divisor $f^*g\neq 0$ and thus injective of sheaves as $T$ is a DVR. We can then conclude $ \rm{L}_1f^*\R^1\pi_*\mathcal M=0$ as well which implies the Lemma.}\end{color}
\end{proof}
Now recall that $\mathcal N$ is trivial on elliptic tails and of positive degree everywhere else. The rank of $\R^1\pi_*\mathcal N$ can be checked on the fibers \cite[Theorem III.12.11]{HAR}, so we see that it is $0$ outside $\mathfrak D^1$ and $1$ on it.

\begin{lem}\label{lemma:semiample}
The line bundle $\mathcal N$ is $\pi$ semi-ample, i.e. the natural map
\[\pi^*\pi_*\mathcal N^{\otimes n}\to \mathcal N^{\otimes n}\]
is surjective.
\end{lem}
\begin{proof}
Outside the locus of elliptic tails $\mathcal N$ is $\pi$-ample. We are left to check on points belonging to an elliptic tail; thanks to the above Lemma we can reduce to the case that $C$ is the central fiber of a one-parameter smoothing of the elliptic tail. This has been proved by Smyth~\cite[Lemma~2.12]{SMY1}.
\end{proof}

\begin{lem}
$\pi_*\mathcal N$ is locally free on $\MM_1^{\rm{div}}.$
\end{lem}
\begin{proof}\cite[Proposition~3.7.2.1]{RSPW}
We have to check that $\pi_*\mathcal N$ has constant rank.
On $\MM_1^{\rm{div}}\setminus \mathfrak{D}^1$ we see that $\R^1\pi_*\mathcal N=0$, so $\pi_*\mathcal N$ satisfies Cohomology and Base Change and its rank is determined by Riemann-Roch.
Given a point $x$ on the boundary $\mathfrak{D}^1$, we can always find a DVR $T$ whose closed point maps to $x$ and whose generic point maps to $\MM_1^{\rm{div}}\setminus \mathfrak{D}^1.$ Then we are in the hypotheses of Lemma~\ref{DVR} and we can check the rank looking at $\pi_*f^*\mathcal N$ over the DVR scheme $T.$ But now $f^*\mathcal N$ is flat over $T$, so $\pi_*f^*\mathcal N$ is as well, which implies torsion-free over $T$.
\end{proof}

\begin{proof}\ref{1-stabilization-div}
Let $S\to \MM_1^{\rm{div}}$ be a smooth atlas, then we have:
 \bcd
 (C,D)\ar[rr,"\phi"]\ar[dr,"\pi"] & & (\hat C=\operatorname{Proj}_{S}(\bigoplus_{n\geq 0}\pi_{S,*}\mathcal N^{\otimes n}),\phi(D))\ar[ld,"\hat\pi"] \\
 & S &
 \ecd
where $\phi$ is proper and birational morphism since $\mathcal N$ is $\pi$-semi-ample and $\hat{\pi}$ is flat since $\pi_*\mathcal N$ is locally free. 
To verify that this define a morphism $S\to \MM_1^{\rm{div}}(1)$ we have to argue that $\hat{C}$ has reduced fibers and only nodes and cusps as singularities.

Since these properties only concern the fibers of $\hat{\pi}$ we can verify them after base change to a DVR scheme $T$ chosen as in Lemma~\ref{DVR} so that the construction commutes with base change. Furthermore we can pick $f\colon T\to \MM_1$ so that the total space $\cC_T$ is regular, so we are in the hypotheses of Smyth's contraction Lemma~\cite[Lemma~2.13]{SMY1}

Finally to conclude that this defines a morphism 
\[\MM_1^{\rm{div}}\to \MM_1^{\rm{div}}(1)\]
it is enough to verify that there is an isomorphism
 $\rm{pr}_1^*\hat\cC\cong\rm{pr}_2^*\hat\cC$ satisfying the cocycle condition, where $\rm{pr}_i\colon S'= S\times_{\MM_1^{\rm{div}}} S\rightrightarrows S$.%and that $\rm{pr}_{ij}\colon S\times_{\MM_1^{\rm{div}}} S\times_{\MM_1^{\rm{div}}} S\to  S\times_{\MM_1^{\rm{div}}} S $ satisfy the cocycle condition.

 This follows from the fact that $\pr_i^*\hat\cC$ are obtained from applying the Proj construction to 
 $\rm{pr}_i^*\pi_{S,*}\mathcal{N}\cong\pi_ {S',*} \rm{pr}_i^*\mathcal N$, by flatness of $S'\to S$. Thus it is enough to show that 
 \[\rm{pr}_1^*\mathcal N\cong \rm{pr}_2^*\mathcal N.\]
  But $\mathcal N$ is the pullback of a line bundle on $\MM_1^{\rm{div}}$, thus the desired isomorphism follows from the commutativity of the following diagram
 
 \bcd
S\times_{\MM_1^{\rm{div}}} S\ar[r,"\rm{pr_1}"]\ar[d, "\rm{pr_2}"] & S\ar[d] \\
S\ar[r] & \MM_1^{\rm{div}}
\ecd
 
The cocycle condition is derived similarly. 
\end{proof}


\begin{prop}
The $1$-stabilisation with divisors descends to the level of weighted curves:
\bcd
\MM_1^{\rm{div}}\ar[r]\ar[d] & \MM_1^{(1),\rm{div}}\ar[d] \\
\MM_1^{\rm{wt}}\ar[r] & \MM_1^{(1),\rm{wt}}
\ecd
\end{prop}
\begin{proof}
{\'E}tale locally on $\MM_1^{\rm{wt}}$ we can choose sections $s_i$ such that their sum as a relative Cartier divisor $D$ has degree compatible with the weight function, so in particular it makes $\omega_{\pi}(E)\otimes\mathcal O_{\cC}(3D)$ trivial on the elliptic tails and $\pi$-ample elsewhere.
If $S\to \MM_1^{\rm{wt}}$ is a smooth atlas, up to taking an {\'e}tale cover we can assume there are sections $s_i$ of $\cC_S\xrightarrow{\pi_S} S$ that define a lifting $S\to \MM_1^{\rm{div}}$ and thus through the above construction a morphism $\xi\colon S\to  \MM_1^{(1),\rm{wt}}.$

In order to show that this descends to a morphism $\MM_1^{\rm{wt}}\rightarrow \MM_1^{(1),\rm{wt}}$ we need to verify that  $\rm{pr}_1(\xi)\cong\rm{pr}_2(\xi)$ and the cocycle condition is satisfied, where $\rm{pr}_i\colon S'= S\times_{\MM_1^{\rm{wt}}} S\rightrightarrows S$.

This boils down to checking that for two different choices of a lifting $S\xrightarrow{s_i,\;s'_i}\MM_1^{\rm{div}}$ we have a unique isomorphism 
\[\hat{\mathcal C}_1=\operatorname{Proj}_S\left((\omega_{\pi}(E)\otimes\mathcal O_{\cC}(3D))^{\otimes n}\right)\cong \operatorname{Proj}_S\left((\omega_{\pi}(E)\otimes\mathcal O_{\cC}(3D'))^{\otimes n}\right)=\hat{\mathcal C}_2. \]
By construction we have a birational map 
 \bcd
&\mathcal C \ar[dl,"\phi_1"]\ar[dr,"\phi_2"]  \\
 \hat{\mathcal C}_1\ar[rr,dashed, "\psi"] & &\hat{\mathcal C}_2.
 \ecd

We want to show that it extends to a regular morphism. 
First of all notice that $ \hat{\mathcal C}_i$ is normal, $i=1,2$. Indeed, since $S$ is smooth and the singularities of the fibers are in co-dimension 1, $ \hat{\mathcal C}_i$ is regular in codimension 1. Moreover since both $S$ (smooth) and the fibers (Cohen-Macaulay) satisfy the ($S_2$) condition of Serre, also the total space does \cite[Thorem~23.9]{MAT}. Then, since the fibers are geometrically connected, Zariski's connectedness theorem implies that
\[\phi_{i,*}\OO_{\mathcal C}\cong \OO_{\hat{\mathcal C}_i} \]
 Moreover notice that by construction $\operatorname{Ex}(\phi_1)\cong \operatorname{Ex}(\phi_2),$ so in particular $\phi_2$ contracts all fibers of $\phi_1.$ Then a standard argument \cite[Lemma 1.15]{debarre}
shows that $\phi_2$ factors through $\phi_1$ and vice versa. This proves the regularity of $\psi$ and its inverse. Notice that $\psi$ is unique as it is the only extension of $\phi_2\circ\phi_1^{-1}$.
\end{proof} 


\section{From $p$-fields to the quintic three-fold}
We shall introduce the moduli space $\Mone{1}{\PP^4}{d}^p$ of $1$-stable curves with $p$-fields, endow it with a $0$-dimensional virtual class, and show that its degree coincides with the genus $1$ cuspidal invariants of the quintic three-fold $X$ up to a sign. This is a word-by-word repetition of the arguments in \cite{CLpfields}, once noticed that they carry over to the situation where we work over a family of Gorenstein (not necessarily nodal) curves. Our aim in this section is to improve the legibility of our paper by providing the non-expert reader with a r\'{e}sum\'{e} of some of the key ideas contained in \cite{CLpfields}; it should otherwise be skipped.

First we introduce the notion of the \emph{cone of sections} of a smooth object $\pazocal Z$ over a family of curves $\cC$: let $B$ be any base (algebraic stack) and let $\pi\colon \cC\to B$ be a flat proper morphism of finite presentation which is representable by algebraic spaces and whose geometric fibers are reduced l.c.i. curves; let $\mathcal L$ be a line bundle on $\cC$. Then there is an algebraic stack over $B$ representing sections of $\mathcal L$, and it can be defined as $C(\pi_*\mathcal L)=\Spec_B(\R^1\pi_*\mathcal L)$; this is because $\R^1\pi_*\mathcal L$ commutes with pullback, and it has the desired modular interpretation by Serre duality. More generally, the cone of section $\mathfrak S$ of $\pazocal Z$ is defined by the universal diagram:
\bcd
& \pazocal Z\ar[d] \\
\cC_{\mathfrak S}\ar[r]\ar[ur,bend left,"\mathfrak e"]\ar[d,"\pi_{\mathfrak S}"] & \cC\ar[d,"\pi"] \\
\mathfrak S \ar[r] & B
\ecd
The previous case can be recovered by setting $\pazocal Z=\rm{Vb}(\mathcal L)$. The morphism $\mathfrak S\to B$ admits a relative dual perfect obstruction theory:
\[ \phi_{\mathfrak S/B}\colon \mathbb T_{\mathfrak S/B}\to \mathbb E_{\mathfrak S/B}:=\R^\bullet\pi_{\mathfrak S,*}\mathfrak e^* T_{\pazocal Z/\cC}\]
Notice that in the case of a line bundle we recover $\mathbb E_{C(\pi_*\mathcal L)/B}=\R^\bullet\pi_*\mathcal L$. The construction for a general smooth $\pazocal Z$ is way more flexible. The proof of this fact is given in \cite[Proposition 2.5]{CLpfields}, and it is enough to notice that it relies on general properties of obstruction theories and the cotangent complex, but never on the specification that $\cC\to B$ be a family of \emph{nodal} curves.

Let us now establish some further notation: let $\w\in k[x_0,\ldots,x_4]_5$ be a homogeneous polynomial such that $X=V(\w)\subseteq\PP^4$ is the smooth quintic three-fold under consideration. In this section we shall denote by $\rm{M}:=\oM_1^{(1)}(\PP^4,d)$, by $(\hat\pi_{\rm M},f_{\rm M})\colon \hat\cC_{\rm M}\to \rm M\times \PP^4$ the universal $1$-stable curve and map over it, by $\L_{\rm M}=f_{\rm M}^*\OO_{\PP^4}(1)$ and by $\mathcal P_{\rm M}=\L_{\rm M}^{\otimes -5}\otimes\omega_{\hat\pi_{\rm M}}$. Furthermore we shall write $\hM$ for $\MM_1^{(1)}$ and $\hP$ for $\mathfrak{Pic}_{\hat\cC\to\hM}$.

\begin{lem}
 $\hP$ is a smooth Artin stack of dimension $0$. Furthermore there is a compatible triple of dual perfect obstruction theories:
 \bcd
 \lambda^*\mathbb T_{\hP/\hM}[-1]\ar[r]\ar[d,"\wr"] &  \mathbb T_{\rm M/\hP} \ar[r]\ar[d] &  \mathbb T_{\rm M/\hM} \ar[r,"{[}1{]}"]\ar[d] & {} \\
 \R^\bullet\hat\pi_{\rm M,*}(\OO_{\hat \cC})\ar[r] & \R^\bullet\hat\pi_{\rm M,*}(\bigoplus_0^4 \mathcal L_{\rm M})\ar[r] & \R^\bullet\hat\pi_{\rm M,*}(f_{\rm M}^* T_{\PP^4})\ar[r,"{[}1{]}"] & {}
 \ecd
 implying that $\mathbb T_{\rm M/\hP}\to \mathbb E_{\rm M/\hP}:=\R^\bullet\hat\pi_{\rm M,*}(\bigoplus_0^4 \mathcal L_{\rm M})$ gives the standard Behrend-Fantechi-Viscardi virtual class on $\rm M$.
\end{lem}
\begin{proof}
 The first statement follows from deformation theory: the projection $\lambda\colon\hP\to\hM$ is unobstructed of relative dimension $0$ and $\hM$ is a smooth Artin stack of dimension $0$, since both nodal and cuspidal singularities are l.c.i., so obstructions to their deformations are contained in $\operatorname{Ext}^2_{\OO_{\hat C}}(\Omega_{\hat C},\OO_{\hat C})=0$.
 
 The fact that $\mathbb T_{\rm M/\hM}\to \mathbb E_{\rm M/\hM}:=\R^\bullet\hat\pi_{\rm M,*}(f_{\rm M}^* T_{\PP^4})$ is a perfect obstruction theory when $\hat\cC\to\rm M$ is a family of Gorenstein curves is proved in \cite[Proposition 6.3]{BF}.
 
 The lower row in the above diagram is induced by the Euler sequence of $\PP^4$. The middle column comes from identifying the space of stable maps as an open substack of the cone of sections (see above) of $\rm{Vb}(\bigoplus_0^4\mathcal L)$ over $\hP$. The existence of such a commutative diagram is \cite[Lemma 2.8]{CLpfields}.
 
 The last claim follows from functoriality of virtual pullback \cite{Manolache-pullback}.
\end{proof}

We proceed to define the moduli space of $p$-fields as the cone of sections of the line bundle $\mathcal P_{\rm M}$ over $\hat\cC_{\rm M}$.

\begin{dfn}
 The moduli space of $1$-stable maps with $p$-fields $\Mone{1}{\PP^4}{d}^p:=C(\hat\pi_{\rm M,*}(\mathcal P_{\rm M}))$ parametrises $1$-stable maps
 \bcd
 \hat\cC_S\ar[r,"f_S"]\ar[d,"\hat\pi_S"] & \PP^4 \\
 S &
 \ecd
 with a $p$-field $\hat\psi\in H^0(\hat\cC_S,f_{S}^*\OO_{\PP^4}(-5)\otimes\omega_{\hat\pi_{S}})$.
\end{dfn}

We shall abbreviate $\pazocal P:=\Mone{1}{\PP^4}{d}^p$. %This should be thought of as the space of sections of the line bundle $\mathcal P_{\rm M}$ over $\hat\cC_{\rm M}$:
%\bcd
%& \rm{Vb}(\mathcal P_{\rm M})\ar[d] \\
%\hat \cC_{\pazocal P}\ar[ur,bend left,"\mathfrak e"]\ar[d,"\hat\pi_{\pazocal P}"]\ar[r] & \hat\cC_{\rm M}\ar[d,"\hat\pi_{\rm M}"] \\
%\pazocal P \ar[r,"\PtoM"] & \rm M
%\ecd

\begin{lem}
 There is a compatible triple of dual perfect obstruction theories \[(\R^\bullet\hat\pi_{\pazocal P,*}(\mathcal P_{\pazocal P}),\R^\bullet\hat\pi_{\pazocal P,*}(\mathcal L_{\pazocal P}^{\oplus 5}\oplus\mathcal P_{\pazocal P}),\R^\bullet\hat\pi_{\pazocal P,*}(\mathcal L_{\pazocal P}^{\oplus 5}))\] for the triangle:
 \bcd
 \pazocal P\ar[rr,"\PtoM"]\ar[dr] & & \rm M\ar[dl] \\
 & \hP &
 \ecd
\end{lem}
See \cite[Proposition 3.1]{CLpfields}. Notice that the virtual rank of $\mathbb E_{\pazocal P/\hP}:=\R^\bullet\hat\pi_{\pazocal P,*}(\mathcal L_{\pazocal P}^{\oplus 5}\oplus\mathcal P_{\pazocal P})$ is $0$, hence it endows the moduli space of $1$-stable maps with $p$-fields with a cycle class of dimension $0$. In facts such a cycle is supported on a way smaller closed substack, namely $\Mone{1}{X}{d}$; this follows from the existence of a cosection of the obstruction bundle whose degeneracy locus is the afore-mentioned substack, and the machinery of cosection localised virtual classes \cite{KLcosection}. Recall their Theorem 1.1:

\begin{teo*}[Localization by cosection]\label{thm:KLlocalisation}
Let $\pazocal M$ be a Deligne-Mumford stack endowed with a perfect
obstruction theory. Suppose the obstruction sheaf $\rm{Ob}_\pazocal M$ admits a
surjective homomorphism $\sigma:\rm{Ob}_\pazocal M|_U  \to \OO_U$
over an open $U\subseteq \pazocal M$.
Let $\pazocal{M}(\sigma)=\pazocal{M}\setminus U$.
Then $(\pazocal{M},\sigma)$ has a localized virtual cycle
$$[\pazocal{M}]^{\rm{virt}}_{\rm{loc}}\in A_* \pazocal{M}(\sigma).
$$
This cycle enjoys the usual properties of the virtual cycles; it relates to
the usual virtual cycle $[\pazocal{M}]^{\rm{virt}}$ via 
$[\pazocal{M}]^{\rm{virt}} = \iota_*[\pazocal{M}]^{\rm{virt}}_{\rm{loc}} \in A_*  \pazocal{M}$, where
$\iota: \pazocal{M}(\sigma)\to \pazocal{M}$ is the inclusion.
\end{teo*}

We are now going to construct the cosection as in \cite[\S\S3.2-3.4]{CLpfields}. There is a morphism of vector bundles on $\hP$ induced by tensoring of line bundles:
\[ h_1\colon\rm{Vb}(\mathcal L_{\hP}^{\oplus 5}\oplus\mathcal P_{\hP})\to \rm{Vb}(\omega_{\hat\pi_{\hP}}),\quad h_1(z,p)=p\w(z_0,\ldots,z_4)\]
By differentiating it and pulling it back along the universal evaluation
\bcd
& \rm{Vb}(\mathcal L_{\hP}^{\oplus 5})\setminus\{0\}\oplus\rm{Vb}(\mathcal P_{\hP})\ar[d] \\
\hat \cC_{\pazocal P}\ar[ur,bend left,"\mathfrak e"]\ar[d,"\hat\pi_{\pazocal P}"]\ar[r] & \hat\cC_{\hP}\ar[d,"\hat\pi_{\hP}"] \\
\pazocal P \ar[r] & \rm \hP
\ecd
(here and in future $\oplus$ at the level of geometric vector bundles means the fiber product over the base) we obtain a cosection of the relative obstruction sheaf
\begin{equation*}\label{eqn:cosection}
 \begin{split}
 \sigma_1\colon\rm{Ob}_{\pazocal P/\hP}=\R^1\hat\pi_{\pazocal P,*}(\mathcal L_{\pazocal P}^{\oplus 5}\oplus\mathcal P_{\pazocal P})\to \R^1\hat\pi_{\pazocal P,*}(\omega_{\hat\pi_{\pazocal P}})\simeq \OO_{\pazocal P} \\
 \sigma_{1|(u,\psi)}(x,p)=p\w(u)+\psi\sum_{i=0}^4\partial_i\w(u)x_i
\end{split}
\end{equation*}

The degeneracy locus of this cosection is $\Mone{1}{X}{d}$: by Serre duality if $\w(u)\neq 0$ then we can find a $p$ such that the cosection does not vanish; similarly we can do if $\psi\sum_{i=0}^4\partial_i\w(u)\neq 0$, but then $\psi=0$ by smoothness of $\w$. $\sigma_1$ lifts to a cosection of the absolute obstruction bundle $\rm{Ob}_{\pazocal P}\to\OO_{\pazocal P}$ with the same degeneracy locus.

We may thus endow $\Mone{1}{\PP^4}{d}^p$ with a localised virtual cycle, and we want to show that it gives the same numerical invariants as the cuspidal Gromov-Witten theory of $X$, up to a sign:
\begin{thm}
 \[\deg[\Mone{1}{\PP^4}{d}^p]^{\rm{vir}}_{\rm{loc}}= (-1)^{5d}\deg[\Mone{1}{X}{d}]^{\rm{vir}}\]%=:GW_1^{\rm{cusp}}(X,d)\]
\end{thm}
This is achieved in \cite[\S\S4-5]{CLpfields} by a family version of the $p$-fields construction applied to the deformation to the normal cone of $X\subseteq \PP^4$; let us denote the latter by $V\to\Aaff^1_t$, so that $V_{t\neq 0}=\PP^4$ and $V_0=N_{X/\PP^4}$.

\begin{lem}
 The deformation to the normal cone $V$ is cut inside $\rm{Vb}(\OO_{\PP^4}(5))\times\Aaff^1_t$ with basis coordinates $[x_0:\ldots:x_4]$ and fiber coordinate $y$ by the equation $\w(x)-ty=0$. If $C(V)$ denotes the affine cone over $V$, then its tangent bundle is determined by the following exact sequences:
 \begin{equation*}
  \begin{split}
   0\to T_{C(V)/\Aaff^1_t}\to\OO^{\oplus 5}_{C(V)}\oplus\OO_{C(V)}\xrightarrow{\sum_i\partial_i\w(x)\mathring{x_i}-t\mathring{y}}\OO_{C(V)}\to 0 \\
   0\to T_{C(V)}\to\OO^{\oplus 5}_{C(V)}\oplus\OO_{C(V)}\oplus\OO_{C(V)}\xrightarrow{\sum_i\partial_i\w(x)\mathring{x_i}-t\mathring{y}-y\mathring{t}}\OO_{C(V)}\to 0
  \end{split}
 \end{equation*}
\end{lem}
See \cite[Lemma 4.1]{CLpfields}. This allows a description of the moduli space of maps to $V$ as the cone of sections of a certain smooth object $\pazocal Z'$ over $\hat\cC_{\hP\times\Aaff^1}$:

\bcd
& \pazocal Z'\ar[d]\ar[r]\ar[dr,phantom,"\Box"] & V\ar[d] \\
& \rm{Vb}(\mathcal L_{\hP}^{\oplus 5})\setminus\{0\}\oplus\rm{Vb}(\mathcal L^{\otimes 5}_{\hP})\ar[d] \ar[r] & \rm{Vb}(\OO_{\PP^4}(5))\times\Aaff^1_t\\
\hat \cC_{\oM_1^{(1)}(V)}\ar[uur,bend left,"\mathfrak e"]\ar[d,"\hat{\pi}_{\oM_1^{(1)}(V)}"]\ar[r] & \hat\cC_{\hP\times\Aaff^1_t}\ar[d,"\hat\pi_{\hP\times\Aaff^1_t}"] & \\
\Mone{1}{V}{(d,0)} \ar[r] & \rm \hP\times\Aaff^1_t &
\ecd

Similarly $\pazocal V:=\Mone{1}{V}{(d,0)}^p$ can be defined as the cone of sections of $\pazocal Z:=\pazocal Z'\oplus\rm{Vb}(\mathcal P_{\hP})$. The general theory explained above provides an obstruction theory for $\pazocal V\to\hP\times\Aaff^1_t$ \cite[Proposition 4.2]{CLpfields}:

\begin{lem}
 A dual perfect obstruction theory is given by \[\phi_{\pazocal V/\hP\times\Aaff^1_t}\colon\mathbb T_{\pazocal V/\hP\times\Aaff^1_t}\to\mathbb E_{\pazocal V/\hP\times\Aaff^1_t}:=\R^\bullet\hat\pi_{\pazocal V}(f_{\pazocal V}^*\mathcal H\oplus\mathcal P_{\pazocal V})\] where $f_{\pazocal V}\colon \hat\cC_{\pazocal V}\to V$ is the universal map and $\mathcal H$ is the vector bundle on $V$ defined by \[0\to\mathcal H\to\pr_{\PP^4}^*\left(\OO_{\PP^4}(1)^{\oplus 5}\oplus \OO_{\PP^4}(5)\right)\xrightarrow{\sum_i\partial_i\w(x)\mathring{x}_i-t\mathring{y}} \pr_{\PP^4}^*\OO_{\PP^4}(5)\to 0\]
 The restriction of $\phi_{\pazocal V/\hP\times\Aaff^1_t}$ to a fiber
 \[
 \pazocal V_t=\left\{\begin{array}{lr} \pazocal P & t\neq 0 \\ \Mone{1}{N_{X/\PP^4}}{d}^p & t=0 \end{array}\right.
\] gives the standard obstruction theory of $\pazocal V_t\to\hP$.
\end{lem}

We would like to conclude that the restriction of the virtual cycle to the fibers is the standard virtual cycle on the fiber. The techniques of functoriality in intersection theory teach us that we should look for a triple of compatible obstruction theories for the triangle:
\bcd
\pazocal V_t\ar[rr,hook,"\iota_t"]\ar[dr] & & \pazocal V \ar[dl] \\
& \hP &
\ecd
The cone of sections interpretation provides us with an obstruction theory relative to $\pazocal V\to \hP$ given by:
\[
 \mathbb E'_{\pazocal V/\hP}:=\R^\bullet\hat\pi_{\pazocal V}(f_{\pazocal V}^*\mathcal K\oplus\mathcal P_{\pazocal V})
\]
where $\mathcal K$ is determined by the following exact sequence on $V$:
\[
 0\to\mathcal K\to\pr_{\PP^4}^*\left(\OO_{\PP^4}(1)^{\oplus 5}\oplus \OO_{\PP^4}(5)\oplus\OO_{\PP^4}\right)\xrightarrow{\sum_i\partial_i\w(x)\mathring{x}_i-t\mathring{y}-y\mathring{t}} \pr_{\PP^4}^*\OO_{\PP^4}(5)\to 0
\]
Of course $h^0(\mathbb E'_{\pazocal V/\hP})\simeq\mathbb T_{\pazocal V/\hP}$, but the previous lemma hints at the fact that the obstruction sheaf $h^1 (\mathbb E'_{\pazocal V/\hP})$ contains one factor $\R^1\hat\pi_{\pazocal V,*}\OO_{\hat\cC_{\pazocal V}}$ too many, so that restricting to the fibers we would find a different obstruction theory with respect to the standard one. A confirmation of this fact is that $\mathbb E'_{\pazocal V/\hP}$ equips $\pazocal V$ with a $0$-dimensional cycle, while we are looking for a $1$-dimensional cycle such that restricting to any fiber (i.e. applying $\iota_t^!$) we get $[\pazocal V_t]^{\rm{vir}}\in A_0(\pazocal V_t)$.

This issue is solved in \cite[\S\S4.5-6]{CLpfields} by lifting the obstruction theory to $\phi_{\pazocal V/\hP}\colon\mathbb T_{\pazocal V/\hP}\to\mathbb E_{\pazocal V/\hP}$, where the latter fits into an exact triangle:
\[ \R^1\hat\pi_{\pazocal V,*}\OO_{\hat\cC_{\pazocal V}}[-2]\to\mathbb E_{\pazocal V/\hP}\xrightarrow{\nu}\mathbb E_{\pazocal V/\hP}\xrightarrow{[1]} \]

A further complication comes from the fact that we need to work with cosection localised cycles. A family version of the cosection is induced by differentiating the following vector bundle morphism on $\hP\times\Aaff^1_t$:
\[
 \rm{Vb}(\mathcal L_{\hP}^{\oplus 5}\oplus\mathcal L_{\hP}^{\otimes 5}\oplus\mathcal P_{\hP})\xrightarrow{(\pr_2,\pr_3)}\rm{Vb}(\mathcal L_{\hP}^{\otimes 5}\oplus\mathcal P_{\hP})\xrightarrow{\cdot}\rm{Vb}(\omega_{\hat\pi_{\hP}})
\]
The cosection takes then the following form:
\[\bar\sigma_{1|(u,v,\psi)}(\mathring{x},\mathring{y},\mathring{p})=\psi\mathring{y}+v\mathring{p}\]
It is showed in \cite[\S4.7]{CLpfields} that $\bar\sigma_1$ lifts to a cosection $\bar\sigma\colon \rm{Ob}_{\pazocal V}\to \OO_{\pazocal V}$ and that the degeneracy locus of $\bar\sigma$ is $\Mone{1}{X}{d}\times\Aaff^1_t$.

Recall that the sections $(x,y)$ are required to satisfy $\w(x)-ty=0$. So $\bar\sigma_1$ coincides up to a non-zero scalar with the above defined cosection $\sigma_1$ for $\pazocal P$ when $t\neq 0$. It is proved in \cite[Theorem 5.2]{KLcosection} that the construction of a cosection localised virtual cycle is compatible with Gysin pullbacks, so that \cite[Proposition 4.9]{CLpfields}:
\[
 \iota_{t\neq0}^![\pazocal V]^{\rm{vir}}_{\rm{\bar\sigma}}=[\pazocal P]^{\rm{vir}}_{\rm{\sigma}}\in A_0(\pazocal Q),\quad \iota_{0}^![\pazocal V]^{\rm{vir}}_{\rm{\bar\sigma}}=[\Mone{1}{N_{X/\PP^4}}{d}^p]^{\rm{vir}}_{\rm{\bar\sigma_0}}\in A_0(\pazocal Q)
\]
where we have denoted by $\pazocal Q:=\Mone{1}{X}{d}$.

We are left with proving that $[\Mone{1}{N_{X/\PP^4}}{d}^p]^{\rm{vir}}_{\rm{\bar\sigma_0}}$ coincides up to sign with $[\Mone{1}{X}{d}]^{\rm{vir}}$. We shall introduce more shorthand notation: $\pazocal N:=\Mone{1}{N_{X/\PP^4}}{d}^p$, and $v\colon\pazocal N\to\pazocal Q$. Chang and Li notice that there is a perfect obstruction theory $\mathbb E_{\pazocal N/\pazocal Q}:=\R^{\bullet}\hat\pi_{\pazocal N,*}(\mathcal L^{\otimes 5}_{\pazocal N}\oplus \mathcal P_{\pazocal N})$ compatible with $\mathbb E_{\pazocal N/\hP}$ and $v^*\mathbb E_{\pazocal Q/\hP}$, so that $\mathbb E_{\pazocal N/\pazocal Q}$ inherits a cosection $\sigma_0'$ with degeneracy locus $D(\sigma_0')=\pazocal Q$. Then \cite[Lemma 5.5]{CLpfields} they show by using the techniques of \cite{KKP} that $\mathfrak C_{\pazocal N/\pazocal Q}$ is supported inside 
\[
 h^1/h^0(\mathbb E_{\pazocal N/\pazocal Q})_{\sigma_0'}:=\operatorname{Ker}(\sigma_0')\cup  h^1/h^0(\mathbb E_{\pazocal N/\pazocal Q})_{|D(\sigma_0')}
\]
so that they may combine the techniques of virtual pullback \cite{Manolache-pullback} and localisation by cosection \cite{KLcosection} to define:
\[
 v^!_{\mathbb E_{\pazocal N/\pazocal Q},\rm{loc}}\colon A_*(\pazocal Q)\to A_*(D(\sigma_0'))
\]
Finally they notice that the fibers of $v$ are vector spaces and the obstruction theory $\mathbb E_{\pazocal N/\pazocal Q}$ is symmetric, so it can be represented as $[T_{v^{-1}(\xi)}\xrightarrow{0}T^*_{v^{-1}(\xi)}]$ along the fibers, and this is enough since we are only interested in the action of $v^!_{\mathbb E_{\pazocal N/\pazocal Q},\rm{loc}}$ on $A_0(\pazocal Q)$ \cite[Theorem 5.7]{CLpfields}.

Hopefully we have managed to convince the reader that the subtle intersection theory perpetuated in \cite{CLpfields} does not rely at all on working with families of \emph{nodal} curves.


\section{Local equations and desingularisation}
\subsection{Notation}
Let $\Z$ be defined by the pullback diagram:
\bcd
\mathcal Z \ar[r]\ar[d]\ar[rd,phantom,"\Box"] & \overline{\mathcal M}_1^{(1)}(\PP^4,d) \ar[d] \\
\mathfrak M_1^{\rm{wt}}\ar[r] & \mathfrak M_1^{(1),\rm{wt}}
\ecd

Objects of $\Z$ over $S$ consist of diagrams
\bcd
\cC\ar[rr,"\phi"]\ar[dr,"\pi"] & & \hat\cC\ar[rr,"f"]\ar[dl,"\hat\pi"] & & \PP^4 \\
& S & & &
\ecd
where $f$ is a $1$-stable map and $\phi$ is the weighted $1$-stabilisation (i.e. contraction of elliptic tails of weight $0$); arrows over $\id_S$ are commutative diagrams
\bcd
\cC\ar[r,"\phi"]\ar[d,"\psi"] &  \hat\cC\ar[r,"f"]\ar[d,"\hat\psi"] & \PP^4 \ar[d,"\id_\PP"]\\
\cC'\ar[r,"\phi'"] &  \hat\cC'\ar[r,"f'"] & \PP^4

\ecd
where $\psi$ and $\hat\psi$ are isomorphisms.  Recall that $\hat \psi$ is determined by $\psi$. %due to the required commutativity with the dominant ``birational'' morphism $\phi$.

Forgetting $\hat \cC$ and keeping $f\circ\phi\colon \cC\to\PP^4$, we obtain a morphism $i\colon\Z\to\oM_1(\PP^4,d).$ 

\begin{lem}
The morphism $i\colon\Z\hookrightarrow\oM_1(\PP^4,d)$ is a closed immersion. In particular $\Z$ is a proper DM stack.
\end{lem}
\begin{proof}
From the above description of arrows in $\Z$, $i$ is  representable (i.e. faithful)  and a monomorphism (i.e. full).

We can check properness using the valuative criterion. We argue as in \cite[Theorem 4.3]{RSPW}. Let $T$ be a DVR scheme with generic point $\eta;$ consider a diagram:
\bcd
\cC_{\eta}\ar[r]\ar[d,"\phi_{\eta}"]  & \cC_T\ar[d,"\phi_T"]\ar[r,"f"] &\PP^4\\
\hat{\cC}_{\eta}\ar[r,"j"]\ar[urr] & \hat{\cC_T}\ar[ur,dashed ,"g"] &
 \ecd 
Notice that there is an open dense substack of $\Z$ where $\phi$ is an isomorphism. Indeed the generic point of either the main component or any boundary component is already $1$-stable. Thus we can assume that $\phi_{\eta}$ in the above diagram is an isomorphism.

Observe that $f$ is constant on the fibers of $\phi$ so it factors topologically through $\hat{\cC}.$
We can conclude as in \cite{RSPW} or show that $\phi_*\OO_{\cC_T}\cong\OO_{\hat{\cC}_T}$ and appeal to \cite[Lemma~1.15]{debarre}. To do that, consider the exact sequence:
\[0\to \OO_{\hat{\cC}_T}\to\phi_*\OO_{\cC_T}\to \phi_*\OO_{\cC_T}/\OO_{\hat{\cC}_T}\to 0\]
Since $\phi$ is an isomorphism away from the cuspidal point, the cokernel is supported in dimension $0$. However $\chi (\OO_{\hat{\cC}_T})=\chi(\phi_*\OO_{\cC_T})$ as we can check on $\eta$ since the Euler characteristic is constant in flat families. So   $\phi_*\OO_{\cC_T}/\OO_{\hat{\cC}_T}=0.$
\end{proof}


So we may add the commutative diagram to the left:
\bcd
\oM_1(\PP^4,d)\ar[d] & \mathcal Z \ar[l,swap,hook,"i"]\ar[r]\ar[d]\ar[rd,phantom,"\Box"] & \overline{\mathcal M}_1^{(1)}(\PP^4,d) \ar[d] \\
\MM^{\rm{wt}}_1 & \mathcal \MM^{\rm{wt}}_1\ar[l,swap,"\sim"]\ar[r] & \mathfrak M_1^{\rm{wt},(1)}
\ecd


From the inclusion we inherit a description of the irreducible components of $\Z$: there is a main component $\Z^\text{main}$ which is the closure of the locus of maps from a smooth elliptic curve, and for every $k\geq 2$ a boundary component $D^k\Z$, whose general point represents a contracted elliptic curve with $k$-many rational tails of positive degree. 

Notice that the above lemma signifies that each and every component of $\Z$ is isomorphic to the corresponding one in $\oM_1(\PP^4,d)$. The point is that given any stable map there is at most one factorisation through the weighted $1$-stabilisation of the curve: objects of $\oM_1(\PP^4,d)\setminus D^1$ are $1$-stable already; objects of $D^1\cap \oM_1(\PP^4,d)^\text{main}$ do factor thanks to Vakil's criterion and objects of $D^1\cap D^k$ ($k\geq 2$) do factor through a map which is constant on the cusp.\marginpar{insert figure of a typical element of $D^1\cap D^2$.} On the other hand, objects of $D^{1,\circ}=D^1\setminus(\oM_1(\PP^4,d)^\text{main}\cup\bigcup_{k\geq 2}D^k)$ do not admit any factorisation, so that $\Z$ has no corresponding component.

We introduce some more notation: let $\XP$ and $\Z^p$ be the algebraic stacks defined by the following cartesian diagram:
\bcd
\mathcal Z^p \ar[r,"\alpha"]\ar[d]\ar[rd,phantom,"\Box"] & \overline{\mathcal M}_1^{(1)}(\PP^4,d)^p \ar[d] \\
\XP \ar[r]\ar[d]\ar[rd,phantom,"\Box"] & \mathfrak{Pic}_1^{(1)} \ar[d] \\
\X\ar[r] & \mathfrak M_1^{(1),\rm{wt}}
\ecd

We are going to use the obstruction theory $\R^\bullet\hat{\pi}_*(\mathcal L^{\oplus 5}\oplus\mathcal P)$ for the morphism $\overline{\mathcal M}_1^{(1)}(\PP^4,d)^p\to\mathfrak{Pic}_1^{(1)}$ to induce a virtual class on $\Z^p$ which we would like to compare with ordinary $p$-fields.

Remark that $\XP$ parametrises
\bcd
\cC\ar[rr,"\phi"]\ar[dr] & & \hat\cC\ar[ld] \\
& S &
\ecd
with a line bundle $\hat{\mathcal L}$ on $\hat{\cC}$. Notice that by pulling back $\hat{\mathcal L}$ via $\phi$ we obtain a line bundle on $\cC$, hence a morphism $\XP\to \mathfrak{Pic}_1$. This is generically an isomorphism, but has $1$-dimensional fibers over the locus of elliptic tails, due to the fact that $\Pic(\hat C)\to\Pic(C)$ has kernel $\mathbb G_{\rm a}$ when $\hat C$ has a cusp.

Similarly $\Z^p$ parametrises
\bcd
\cC\ar[rr,"\phi"]\ar[dr,"\pi"] & & \hat\cC\ar[ld,"\hat\pi"] \ar[r,"f"] & \PP^4\\
& S & &
\ecd
with a $p$-field $\psi\in H^0(\hat\cC,f^*\OO_{\PP^4}(-5)\otimes\omega_{\hat\pi}$.
\begin{remark}
why we cannot include $\Z^p$ into $p$-fields
\end{remark}

As anticipated, we may endow $\Z^p$ with a virtual class by ``localised virtual pullback'': indeed $\XP$ is a smooth Artin stack, and:
\[
\mathfrak C_{\Z^p/\XP} \subseteq \alpha^*\mathfrak C_{\Mone{1}{\PP^4}{d}^p/\mathfrak{Pic_1^{(1)}}} \subseteq \alpha^* h^1/h^0(\mathbb E_{\Mone{1}{\PP^4}{d}^p/\mathfrak{Pic_1^{(1)}}})_\sigma
\]

\begin{lem}
localised virtual pullback commutes with pushforward
\end{lem}
\marginpar{check \cite{KLcosection}}

\begin{cor}
$\deg[\Z^p]^{\rm{vir}}_{\rm{loc}}=\deg[\Mone{1}{\PP^4}{d}^p]^{\rm{vir}}_{\rm{loc}}$
\end{cor}
\subsection{Equations for $\Z^p$ relative to $\XP$}
We are going to need a description of the normal cone $\mathfrak C_{\Z^p/\XP}$ in order to perform a splitting.

Since $\Z^p$ simply is a line bundle over the boundary of $\Z$, we may instead find equations for the latter.

Recall that $\Z$ can be embedded as an open inside $C(\hat{\pi}_*\mathcal L^{\oplus 5})$ over $\XP$. We are going to find an embedding of $C(\hat{\pi}_*\mathcal L^{\oplus 5})$ in a smooth ambient space over $\XP$, that will be a vector bundle obtained by suitably twisting $\mathcal L$.

Following \cite{HL}, we work locally on $\Z$: start with a point $\xi=[(C\xrightarrow{\phi}\hat C\xrightarrow{f}\PP^4]\in\Z$ and choose coordinates on $\PP^4$ such that $f^{-1}\{x_0=0\}$ is a simple smooth divisor $D=\sum_{i=1}^d\delta_i$ on $\hat C$. This continues to be true on a neighbourhood $U$.

 Locally the morphism $\Z\to\XP$ can be written as $\xi\mapsto[C\to\hat C,\OO_{\hat C}(D)]$, which admits a local lifting $U\to\MM_1^{(1),\rm{div}}$ and in fact hits the smooth locus of the latter.
 
  Notice though that the projection $\MM_1^{(1),\rm{div}}\to \XP$ (or to $\Pic_1^{(1)}$ for what it is worth) is \emph{not} smooth. In fact, when the line bundle is trivial on the minimal elliptic subcurve $E$, it may be deformed to a degree $0$, non-effective line bundle on such a subcurve, so that sections of $\OO_{\hat C}(D)$ which are constant and non-zero on $E$ are obstructed.

There is a way around this: in a neighbourhood $V\subseteq \XP$ of $[C\to\hat C,\OO_{\hat C}(D)]$ we can write the universal line bundle $\mathcal L_V$ as $\OO_{\hat\cC_V}(\pazocal D + p-p_0)$. Indeed we can pick a local section $p_0$ through the minimal genus $1$ subcurve, so that $\mathcal L_V(p_0)$ becomes effective. We should then think of $p$ as a local coordinate on $\XP$ relative to $\X$.

Locally on $V$ we can pick another smooth section $\A$ of the minimal genus $1$ subcurve not intersecting $p_0$, neither the support of $\pazocal D+p$.

\begin{lem}
$C(\hat\pi_*\mathcal L)$ is the kernel of the vector bundle map:
\[ \hat\pi_*\OO_{\hat\cC}(\A+\pazocal D+p-p_0)\xrightarrow{\varphi}\hat\pi_*\OO_{\A}(\A)\]
Up to shrinking $V$ we may write:
\[\hat\pi_*\OO_{\hat\cC}(\A+\pazocal D+p-p_0)\cong\bigoplus_{i=1}^d\hat\pi_*\OO_{\hat\cC}(\A+\pazocal \delta_i+p-p_0)\oplus\hat\pi_*\OO_{\hat\cC}(\A+p-p_0)\]
\end{lem}
Compare with \cite[Lemma 4.10]{HL}. Denote by \[\varphi_i\colon\hat\pi_*\OO_{\hat\cC}(\A+\pazocal \delta_i+p-p_0)\to\hat\pi_*\OO_{\A}(\A)\] (and similarly $\varphi_p$) the composite of the inclusion with $\varphi$.

Let us introduce some more notation: around a point $[\hat C]\in\MM_1^{(1),\rm{wt}}$, for every node $q$ of $\hat C$ there is a coordinate $\zeta_q$ whose vanishing locus is the divisor where such a node is \emph{not} smoothed. These functions can be pulled back to $V$. Denote by \[\zeta_{[\delta_i,a]}=\prod\zeta_q\]
where the product runs over all the nodes separating $\delta_i$ from the minimal genus $1$ curve.
 
\begin{lem}
We may find an explicit local expression for $\varphi_i$ and $\varphi_p$ after trivialising the relevant line bundles:
\[\varphi_i=\zeta_{[\delta_i,a]}, \quad \varphi_p=(p-p_0)\]
\end{lem}
Compare with \cite[Proposition 4.13]{HL}.
\begin{remark}
The vanishing locus of $(p-p_0)$ on the boundary means that the line bundle restricts to the trivial one on the minimal genus $1$ subcurve. The meaning of it is not clear outside the boundary.
\end{remark}

\begin{lem}\label{lem:equations}
A local chart $U$ for $\Z$ can be embedded as an open inside:
\[ (F_0=\ldots=F_4=0)\subseteq \rm{Vb}(\hat{\pi}_*\mathcal L^{\oplus 5}) \]
where
\[ F_j=\sum_{i=1}^d \zeta_{[\delta_i,a]}w_i^j+(p-p_0)w_{d+1}^j \]
and $w_i^j$ are coordinates on the fiber of the $j$-th copy of $\rm{Vb}(\hat{\pi}_*\mathcal L)$ over $\XP$.
\end{lem}
Compare with \cite[Theorems 2.17-19]{HL}.

\subsection{Hu-Li blow-up and desingularisation}
We perform a modular blow-up of $\MM_1^{1,\rm{wt}}$: we successively blow up $\hat\Theta_k, \;k\geq 2$  defined as the closure of the loci where the minimal elliptic subcurve $E$ has weight $0$ and $\lvert\overline{C\setminus E}\cap E\rvert=k.$

Notice that after the $k$-th blow-up, the strict transform of $\Theta_{k+1}$ is smooth, so the final result  $\widetilde{\MM}_1^{1,\rm{wt}}$ is smooth as well. 

\begin{remark}
The fiber product 
\[\widetilde{\MM}_1^{1,\rm{wt}}\times_{\MM_1^{1,\rm{wt}}}\MM_1^{\rm{wt}}\]
recovers the Hu-Li blow-up $\widetilde{\MM}_1^{\rm{wt}}.$ The key observation is that $\Theta_1$ is already a Cartier divisor and the pullback of $\hat\Theta_k$ is precisely $\Theta_k$.
\marginpar{you can use the universal property of the blow up to show there are maps in both directions. Check the statement about the $\Theta_k$}
\end{remark}

\begin{remark}\label{rmk:eqn}
After blowing up, the equations in \ref{lem:equations} are simplified and assume the following form:
\[\tilde\zeta\tilde w+(p-p_0)w_{d+1}=0\]
where $\tilde\zeta$ is one of the newly created boundary divisors $\widetilde{\Theta_k}$ from $\widetilde{\MM}_1^{\rm{wt}}$ (i.e. one of the exceptional divisors produced by the blow-up process), and $\tilde w$ is a suitably defined coordinate on the fiber of $\rm{Vb}(\hat{\pi}_*\mathcal L)\times_{\XP}\widetilde{\XP}$.
\end{remark}

Summing up, we get:
\bcd
   &  \widetilde{\Z}^p \ar[r]\ar[d]\ar[rd,phantom,"\Box"] & \tM_1^{(1)}(\PP^4,d)^p \ar[d] \\
\tM_1(\PP^4,d)\ar[d] & \widetilde{\Z} \ar[l,hook,swap,"i"]\ar[r]\ar[d]\ar[rd,phantom,"\Box"] & \tM_1^{(1)}(\PP^4,d) \ar[d] \\
\widetilde{\mathfrak{Pic}}_1\ar[d] &\widetilde{\XP}\ar[l]\ar[r]\ar[d]\ar[rd,phantom,"\Box"] & \widetilde{\mathfrak{Pic}}_1 ^{(1)}\ar[d]\\
\widetilde{\MM}^{\rm{wt}}_1 & \widetilde{\X}\ar[l,swap,"\sim"]\ar[r] & \widetilde{\MM}_1^{(1),\rm{wt}}
\ecd




\begin{comment}
where this time an object of $\Z^p$ over $S$ is given by
\bcd
\cC\ar[rr,"\phi"]\ar[dr,"\pi"] & & \hat\cC\ar[rr,"f"]\ar[dl,"\hat\pi"] & & \PP^4 & \text{and} & \xi\in\Gamma(\hat\cC,f^*\OO_\PP(-5)\otimes\omega_{\hat\cC/S}) \\
& S & & & & &
\ecd
(I think to satisfy the stack condition $\xi$ should be really thought of as a section of $\hat\pi_*(f^*\OO_\PP(-5)\otimes\omega_{\hat\cC/S})$.)

For the existence of $j$ we are claiming that, pulling back along $\phi$, $\xi$ induces a section of $\pi_*((f\circ\phi)^*\OO_\PP(-5)\otimes\omega_{\cC/S})$. We may work on an atlas for $\Z^p$, which we shall (maybe abusing notation slightly) denote by $S$, as the base scheme in the above diagram; let us also denote by $\hat{\mathcal L}=f^*\OO(1)$ and $\L=\phi^*\hL$.

First we claim that the adjunction map $\OO_{\hat\cC}\to\phi_*\OO_\cC$ is an isomorphism: it is injective by dominance of $\phi$; to check the cokernel is trivial it is enough to do so after restricting to each and every irreducible component of $\Z^p$. Then $\hat\cC$ is normal\marginpar{NO, $\hat\cC_{|D^k}$ has multiple components} (so is the base\footnote{on VZ here}; R1 follows from the fact that singularities are isolated in the fiber, S2 \footnote{OK when fibers are Cartier i.e. over a DVR; actually take a look at Thm 23.9 in Matsumura's Commutative Ring Theory, fibers are CM in the situation at hand } follows from reducedness of the fibers) and we conclude by Zariski's main theorem (geometric fibers of $\phi$ are either points or elliptic curves, in either case connected).

The equality $\phi^*\omega_{\hat\cC/S}=\omega_{\cC/S}(\mathcal E)$, where $\mathcal E$ is the locus spanned by elliptic tails, can be checked on $\X$ and then pulled back. Notice that $\mathcal E$ is a Cartier divisor; $\phi$ is generically an isomorphism, so $\phi^*\omega_{\hat\cC/S}$ and $\omega_{\cC/S}$ may differ only on the locus where $\phi$ is not an isomorphism. The statement may now be proved by an intersection-theoretic argument by reducing to smoothings over the spectrum of a DVR, see\cite[Lemma 2.13]{SMY1}.

It is clear now that $\omega_{\cC/S}\otimes\L^{\otimes -5}\hookrightarrow \phi^*(\omega_{\hat\cC/S}\otimes\hL^{\otimes-5})$. Pushing down along $\pi=\hat\pi\circ\phi$, we get a map $\pi_*(\omega_{\cC/S}\otimes\L^{\otimes -5})\hookrightarrow \hat\pi_*(\omega_{\hat\cC/S}\otimes\hL^{\otimes-5})$ (using the projection formula and $\phi_*\OO_\cC=\OO_{\hat\cC}$). These are both $0$ on $\Z^{\text{main},\circ}=\Z^\text{main}\setminus(\bigcup_{k\geq2} D^k\Z)$; on the other hand they are both line bundles on $D^k\Z$... \marginpar{Fix me}

\begin{lem}
There is a close embedding $j\colon \Z^p\hookrightarrow \oM_1(\PP^4,d)^p$.
\end{lem}

Notice that the $p$-field is forced to vanish on $\Z^{\text{main},\circ}$, so $(\Z^p)^{\text{main},\circ}\simeq\Z^{\text{main},\circ}$ is the zero-section of the cone $\Z^p\to\Z$ (even though $\oM_1(\PP^4,d)^p\to \oM_1(\PP^4,d)$ is non-trivial on $\oM_1(\PP^4,d)^\text{main}\cap D^1$).

Finally it will be useful to introduce
\bcd
\XP\ar[r]\ar[d]\ar[dr,phantom,"\Box"] & \mathfrak{Pic}_1^{(1)}\ar[d] \\
\X\ar[r] & \MM_1^{(1)}
\ecd
so that objects of $\XP(S)$ are
\bcd
\cC\ar[rr,"\phi"]\ar[dr,"\pi"] & & \hat\cC\ar[dl,"\hat\pi"] & \text{and} & \hL\in\Pic_{\hat \cC/S}(S) \\
& S & & &
\ecd
Notice that the map $\XP\to\mathfrak{Pic}$ that associates to an object as above $(\cC\to S,\phi^*\hL)$ is highly non-trivial on the locus of elliptic tails/cusps, since
\begin{itemize}
\item line bundles of the same degree on the cusp are identified (there is a $\mathbb G_a$ wealth of them), and
\item only line bundles that restrict to effective line bundles on the elliptic tail are in the image of this morphism.
\end{itemize}
\end{comment}
We conclude this brief section remarking that the blow up procedure does not affect the invariants:
\begin{lem}
We have the identity:
\[\deg\virloc{\tZp}=\deg\virloc{\Zp}\]
\end{lem}
Compare with \cite[Proposition~2.5]{CL}.
\section{Splitting the cone and proof of the Main Theorem}
We are finally in a position to study the cone $\mathfrak{C}_{\tZp/\tXP}.$ This is essentially going to be a word-by-word repetition of the arguments in \cite{CLpfields}.
\begin{lem}\label{lem:open_cones}
Let $\tilde{\rho}\colon \tZp\to\tXP$ be the natural map and $\mathbb {E}_{\tZp/\tXP}=\R\hat\pi_*(\mathcal L^{\oplus 5}\oplus\mathcal P)$  the relative perfect obstruction theory for $\tilde{\rho},$ then $\mathfrak{C}_{\tZp/\tXP}$ has the following properties:
\begin{enumerate}
\item Its restriction to  $\tZ^{p,\circ}= \tZ^{p,\rm{main}}\setminus \bigcup_{k\geq 2}D^k \tZp$ can be described as the zero section of $h^1/h^0(\mathbb {E}_{\tZp/\tXP})\rvert_{\tZ^{p,\circ}}$
\item Its restriction to $\tZ^{p,gst,\circ}=\tZp - \tZ^{p,\rm{main}}$  is a rank $2$ subbundle stack of $h^1/h^0(\mathbb {E}_{\tZp/\tXP})\rvert_{\tZ^{p,gst,\circ}}$
\end{enumerate}
\end{lem}
\begin{proof} Compare with \cite[Lemma 4.3]{CLpfields}
\begin{enumerate}
\item Observe that $\tZ^{p,\circ}\cong \tZ^{\circ}$ because here $H^0(\hat C, L^{\otimes -5}\otimes \omega_{\hat C})=0$. Moreover $\tZ^{\circ}$ is unobstructed on its image, which is an open of $\tXP$, because $\R^1\hat{\pi}_*\mathcal L=0$.
So the normal cone is $[\tZ^{p,\circ}/\hat{\pi}_*\mathcal L^{\oplus 5}]$, which is the zero section of $h^1/h^0(\mathbb {E}_{\tZp/\tXP})\rvert_{\tZ^{p,\circ}}=[0\oplus \R^1\hat{\pi}_*\mathcal P/\hat{\pi}_*\mathcal L^{\oplus 5}\oplus 0]$.
\item We know that $\tZ^{p,gst,\circ}$ is a line bundle over $\tZ^{gst,\circ}$. From the equations \ref{rmk:eqn} we see that the latter is smooth over its image $\pazocal W$ in $\tXP$, which is the codimension $2$ locus where the minimal genus $1$ subcurve has weight $0$ and the line bundle is trivial on it. Recall that every smooth morphism $A\to B$ factors as $A\xrightarrow{\acute{e}t} B\times \Aaff^n\xrightarrow{\pr_1} B$. So we have
\bcd
\tZ^{p,gst,\circ} \ar[r,"\acute{e}t"] & \pazocal W\times\Aaff^{5d+5}\ar[r,hook]\ar[d,"q"] & \tXP\times \Aaff^{5d+5}\ar[d] \\
& \pazocal W \ar[r,hook] & \tXP
\ecd
where the bottom horizontal arrow is a codimension $2$ regular embedding. Thus 
\[\mathfrak{C}_{\tZp/\tXP}\rvert_{\tZ^{gst,\circ}}\cong \left[ q^* C_{\pazocal W/\tXP}/ \hat{\pi}_*\mathcal L^{\oplus 5}\right]\]
is a rank 2 subbundle stack of  $h^1/h^0(\mathbb {E}_{\tZp/\tXP})\rvert_{\tZ^{p,gst,\circ}}.$
\end{enumerate}
\end{proof}

 Notice that the image of $\tZ^{\circ}$ in $\tM_1(\PP^4)$ contains $\tM_1(\PP^4)^{main}\cap \tilde{D}^1.$

Recall the definition of the \emph{closure of the zero section of a vector bundle stack}: let $B$ be an integral algebraic stack and let $[F_0\xrightarrow{d} F_1]$ be a complex of locally free sheaves on $B$. The zero section is $0_{\mathbf F}\colon [F_0/F_0]\to\mathbf F=[F_1/F_0]$ (notice that it is not in general a closed embedding); the closure of the zero section is then defined as:
\[ \overline{0}_{\mathbf F}=[\operatorname{cl}(dF_0)/F_0] \]
$\overline{0}_{\mathbf F}$ is an integral stack.

\begin{ex}
When $h^0(F_\bullet)=0$, the closure of the zero section looks like $B$ with some stacky structure on the vanishing locus of $d$. Consider for example $B=\PP^1$ and $F_\bullet=[\OO_{\PP^1}\xrightarrow{x}\OO_{\PP^1}(1)]$. Then the action of $e\in F_0$ on $F_1$ is by $f\mapsto f+xe$. Clearly $\operatorname{cl}(dF_0)$ is the whole line bundle $F_1$; the $F_0$-action is transitive on the fibers over $\{x\neq 0\}$ and trivial on the $\{x=0\}$-fiber. Hence $\overline{0}_{\mathbf F}$ is isomorphic to $\PP^1\setminus\{x=0\}$ with a gerbe $[\Aaff^1/\mathbb G_{\rm a}]$ replacing the point $\{x=0\}$.
\end{ex}

We may now split the cone $\mathfrak{C}_{\tZp/\tXP}$ in the following manner: we denote by $\mathfrak C^{\rm{main}}$ the closure of the zero section of $h^1/h^0(\mathbb {E}_{\tZp/\tXP})\rvert_{\tZ^{p,\rm{main}}}$, which is an irreducible cone supported on the main component; all the rest is supported on the boundary components, possibly on their intersection with the main one, and we are going to pack all the components supported on $D^k\tZp$ together and label them $\mathfrak C^k$ accordingly, so in the end we obtain a splitting:
\[
 \mathfrak{C}_{\tZp/\tXP}=\mathfrak C^{\rm{main}}+\sum_{k\geq 2} \mathfrak C^k
\]
We are going to show that:
\begin{enumerate}
 \item the contribution of $\mathfrak C^{\rm{main}}$ is exactly the reduced invariants of $X$;
 \item the other cones $\mathfrak C^k,\ k\geq 2,$ are enumeratively meaningless.
\end{enumerate}

In order to prove the first we proceed as in \cite[\S5]{CLpfields}: notice that the obstruction theory $\mathbb E$ splits as $\mathbb E_1\oplus\mathbb E_2$ where $\mathbb E_1=\R\hat\pi_*(\mathcal L^{\oplus 5})$ and $\mathbb E_2=\R\hat\pi_*(\mathcal P)$. When we restrict ourselves to $\tZ^{p,\rm{main}}$ we see that $\mathbb E_1$ is the closure of its own zero section; it follows that:
\[
 \mathfrak C^{\rm{main}}=\overline{0}_{\mathbb E\rvert_{\tZ^{p,\rm{main}}}}=\mathbb E_1\rvert_{\tZ^{p,\rm{main}}}\oplus \overline{0}_{\mathbb E_2\rvert_{\tZ^{p,\rm{main}}}}
\]
Then by excess intersection:
\[
 0^!_{\mathbb E}[\mathfrak C^{\rm{main}}]=0_{\mathbb E_2}^![\overline{0}_{\mathbb E_2\rvert_{\tZ^{p,\rm{main}}}}]
\]

At this point we recall the following \cite[Lemma 5.3]{CLpfields}:
\begin{lem}
Let $\mathbb E=[E_0\to E_1]$ be a complex of locally free sheaves on an integral Deligne-Mumford stack $B$ such that
$H^1(\mathbb E)$ is a torsion sheaf on $B$ and the image sheaf of $E_0\to E_1$ is locally free.
Let $U\subseteq B$ be the complement of the support of $H^1(\mathbb E)$, and let $\mathbf{B}\subseteq h^1/h^0(\mathbb E^\vee[-1])$
be the closure of the zero section  of the vector bundle $h^1/h^0(\mathbb E^\vee[-1]|_U)= H^0(\mathbb E|_U)^\vee$. Then
$$0^![\mathbf{B}]=e(H^0(\mathbb E)^\vee)\in A_*(B).
$$
\end{lem}

We apply this lemma to $\mathbb E=\R\hat{\pi}_*\mathcal L^{\otimes 5}$. Notice that it satisfies the hypotheses by virtue of the equations in Remark \ref{rmk:eqn}: indeed the question may be addressed locally; looking at the resolution of $\mathbb E$:
\[
 \hat\pi_*\mathcal L^{\otimes 5}(\A)\to \hat\pi_*\mathcal L^{\otimes 5}(\A)\rvert_{\A}
\]
we deduce from the equation that the image sheaf of this map is $\pi_*\mathcal L^{\otimes 5}(\A)\rvert_{\A}\otimes\OO_{\tZ^{p,\rm{main}}}(-\Delta)$, where $\Delta$ denotes the boundary of the main component $\Delta=\tZ^{p,\rm{main}}\cap\left(\bigcup_{k\geq 2}D^k\tZp\right)$. Then $\hat\pi_*\mathcal L^{\otimes 5}$ is a vector bundle.

\begin{lem}
 If we let $i$ be the inclusion of $\tZ$ in $\tM_1(\PP^4,d)$, then:
 \[
  i_*(c_{\rm{top}}(\hat{\pi}_*\hat{\mathcal L}^{\otimes 5})\cap[\tZ^{p,\rm{main}}])=c_{\rm{top}}({\pi}_*\mathcal L^{\otimes 5})\cap[\tM_1(\PP^4,d)^{p,\rm{main}}]
 \]
\end{lem}
\begin{proof}
 Obviously $i_*[\tZ^{p,\rm{main}}]=[\tM_1(\PP^4,d)^{p,\rm{main}}]$. On the other hand notice that on $\tZ^{p,\rm{main}}$ we have:
 \[
  \pi_*\mathcal L=\hat{\pi}_*\phi_*\phi^*\hat{\mathcal L}=\hat{\pi}_*\hat{\mathcal L}
 \]
by projection formula and since $\phi_*\OO_{\cC_{\tZ^{p,\rm{main}}}}=\OO_{\hat\cC_{\tZ^{p,\rm{main}}}}$. The result follows then from the projection formula for Chern classes.
\end{proof}

We are left with showing that the rest of the $\mathfrak C^k$'s do not contribute to the invariants. This is essentially a dimensional computation. The arguments of \cite[\SS6-8]{CLpfields} may be directly applied; we shall outline them for the benefit of the reader. We introduce the notation $\tZ^{p,\rm{gst}}:=\bigcup_{k\geq 2} D^k\tZp$ for the union of the boundary components, and $\mathfrak C^{\rm{gst}}=\bigcup_{k\geq 2}\mathfrak C^k$.

\subsection*{Step I: reduction to the case of a cone inside a vector bundle and homogeneity}
This section deals with removing the technicalities of working with a cone stack inside a vector bundle stack.

The key point is that $\mathbb E\rvert_{\tZ^{p,\rm{gst}}}$ has locally free $h^0$ \emph{and} $h^1$, as can be seen from the equations. Then, when we pick a resolution by locally free sheaves $\mathbb E=[F_0\xrightarrow{d} F_1]$, the image sheaf $d(F_0)$, which is the kernel of $F_1\to h^1(\mathbb E\rvert_{\tZ^{p,\rm{gst}}})$, is really a sub-vector bundle of $F_1$. Then the projections:
\[
 \beta\colon F_1\to h^1/h^0(\mathbb E) \quad \text{and} \quad \beta'\colon F_1\to \tilde{V}:=\R^1\hat{\pi}_*(\hat{\mathcal L}^{\oplus 5}\oplus\mathcal P)
\]
are both flat. The cone stack $\mathfrak C^{\rm{gst}}$ can be descended to a cone $C^{\rm{gst}}$ by means of taking the quotient of $\beta^{-1}\mathfrak C^{\rm{gst}}$ by the free action of $d(F_0)$; $C^{\rm{gst}}$ should then be thought of as the coarse moduli of $\mathfrak C^{\rm{gst}}$. Recall that the cosection $\sigma$ is induced by a cosection $\sigma_1$ of $\tilde V$ (see Eq. \eqref{eqn:cosection}). It follows from the commutativity of localised Gysin pullback with flat pullback that:
\[
 0^!_{h^1/h^0(\mathbb E),\sigma}(\mathfrak C^{\rm{gst}})= 0^!_{\tilde V,\sigma_1}(C^{\rm{gst}})
\]
See \cite[Proposition 6.3]{CLpfields}.

They then introduce the notion of \emph{homogeneity} for substacks of $\tilde V$: write $\tilde V=\tilde V_1\oplus\tilde V_2$ with $\tilde V_1=\R^1\hat{\pi}_*(\hat{\mathcal L}^{\oplus 5})$ and $\tilde V_2=\R^1\hat{\pi}_*(\mathcal P)$, and $\gamma\colon \tZ^{p,\rm{gst}}\to\tZ^{\rm{gst}}$ the projection. Since $\tZ^{p,\rm{gst}}$ is the total space of a line bundle over $\tZ^{\rm{gst}}$, it comes with a natural $\Gm$-action on the fibers of $\gamma$, and since $\tilde V_i=\gamma^*V_i$ for the corresponding vector bundles $V_i$ on $\tZ^{\rm{gst}}$, the total space of $\tilde V_i$ can be endowed with a $\Gm$-action that makes the projection to $\tZ^{p,\rm{gst}}$ equivariant. A closed substack of $\tilde V$ is $0$-homogeneous if it is the pullback of a closed substack of $V$ along $\gamma$. In facts the $\tilde V_i$'s can be endowed with different $\Gm$ actions that make the projection to $\tZ^{p,\rm{gst}}$ equivariant by twisting with two characters of $\Gm$, one for each $\tilde V_i$; this defines the concept of $(l_1,l_2)$-homogeneous substacks of $\tilde V$. Here is how we are going to use the homogeneity:

\begin{lem}
 Let $\tilde C\subseteq \tilde V$ be an $(l_1,l_2)$-homogeneous sub\emph{cone} of $\tilde V$; then the cone $\tilde C\cap(0\oplus\tilde V_2)$ is pulled back from a cone in $V_2$.
\end{lem}
\begin{proof}
 Locally we may pick coordinates $t$ on the fibers of $\gamma$, $x_1,\ldots,x_5$ on the fibers of $\tilde V_1$, and $y_1,\ldots,y_{5d+5}$ on the fibers of $\tilde V_2$, such that the ideal of $\tilde C$ is generated by homogeneous polynomials $p_j$ in $t^{-l_1}x_i$ and $t^{-l_2}y_i$. The ideal of $\tilde C\cap(0\oplus\tilde V_2)$ is then given by $\langle x_1,\ldots, x_5,p_j(0,t^{-l_2}y)\rangle_j$, where $p_j(0,t^{-l_2}y)$ results from setting $x_i=0$ in $p_j$; notice now that $\tilde C$ being a cone, it is invariant by scalar multiplication on the fibers of $\tilde V$, so we may as well say that $\tilde C\cap(0\oplus\tilde V_2)$ is cut by the ideal $\langle x_1,\ldots, x_5,p_j(0,y)\rangle_j$. This makes it clear that $\tilde C\cap(0\oplus\tilde V_2)$ is pulled back from $(0\oplus V_2)$ on $\tZ^{\rm{gst}}$.
\end{proof}

Finally Chang and Li point out that the coarse moduli cone $C^{\rm{gst}}$ is $(0,1)$-homogeneous \cite[Proposition 6.7]{CLpfields}: recalling the interpretation of $\Mone{1}{\PP^4}{d}^p$ as an open inside the cone of sections of $\mathcal V=\rm{Vb}(\mathcal L^{\oplus 5}\oplus \mathcal P)$ over $\hat\cC_{\mathfrak{Pic}_1^{(1)}}$, the desired $\Gm$-action on the fibers of $\gamma\colon \tZ^{p,\rm{gst}}\to\tZ^{\rm{gst}}$ is induced by endowing $\rm{Vb}(\mathcal L^{\oplus 5}\oplus \mathcal P)$ with the $\Gm$-action that is trivial on the fibers of every copy of $\rm{Vb}(\mathcal L)$, and has character $1$ on those of $\rm{Vb}(\mathcal P)$, with an underlying trivial action on $\mathfrak{Pic}_1^{(1)}$. This influences the obstruction theory  $\R^\bullet\hat\pi_*\left(\mathfrak e^* T_{\mathcal V/\hat\cC_{\mathfrak{Pic}_1^{(1)}}}\right)$ of $\Mone{1}{\PP^4}{d}^p$ in the obvious way, and consequently $\mathbb E$ on $\tZp$.
























\begin{comment}{
We may notice that $(\Z^p)^{\text{main},\circ}\to\XP$ is smooth onto its image, which is an open substack; furthermore on this open the relative tangent is represented by $\hat\pi_*\hL^{\oplus 5}$, and $\R^1\hat\pi_*\hL^{\oplus 5}=\hat\pi_*(\hat\omega\otimes\hL^{\otimes -5})=0$. Let $E^\bullet=\R^\bullet\hat\pi_*(\hL^{\oplus 5}\oplus \hat\omega\otimes\hL^{\otimes -5})$ denote the dual perfect obstruction theory of $\Z^p\to \XP$. Then the intrinsic normal cone of $\Z^p\to \XP$ splits into:
\begin{itemize}
\item the closure of the zero section of $h^1/h^0(E^\bullet)_{|\text{main},\circ}$, which we shall name $\mathfrak C^{\text{main}}$;
\item other components supported on the boundary, which we should accordingly name $\mathfrak C^k$ ($k\geq 2$).
\end{itemize}}
\end{comment}
\bibliographystyle{alpha}
\bibliography{cusp}

\end{document}

